<!DOCTYPE html>
<html>
<head>
    <title>è®¤è¯çŠ¶æ€æ£€æŸ¥</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .ok { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; }
    </style>
</head>
<body>
    <h2>ğŸ” è®¤è¯çŠ¶æ€æ£€æŸ¥</h2>
    <div id="status"></div>

    <script>
        const statusDiv = document.getElementById('status');

        // æ£€æŸ¥localStorage
        const token = localStorage.getItem('token');
        const accessToken = localStorage.getItem('access_token');
        const user = localStorage.getItem('user');

        let html = '<h3>LocalStorage çŠ¶æ€:</h3>';

        if (token) {
            html += `<p class="ok">âœ… token: ${token.substring(0, 50)}...</p>`;
        } else {
            html += `<p class="error">âŒ token: ä¸å­˜åœ¨</p>`;
        }

        if (accessToken) {
            html += `<p class="info">â„¹ï¸  access_token: ${accessToken.substring(0, 50)}... (ä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ª)</p>`;
        }

        if (user) {
            html += `<p class="ok">âœ… user: ${user}</p>`;
        } else {
            html += `<p class="error">âŒ user: ä¸å­˜åœ¨</p>`;
        }

        html += '<hr><h3>å»ºè®®:</h3>';

        if (!token) {
            html += '<p class="error">âŒ æœªç™»å½•æˆ–tokenå·²æ¸…é™¤</p>';
            html += '<p>è¯·è®¿é—® <a href="http://localhost:5173">http://localhost:5173</a> é‡æ–°ç™»å½•</p>';
        } else {
            html += '<p class="ok">âœ… Tokenå­˜åœ¨ï¼Œå°è¯•è°ƒç”¨API...</p>';

            // æµ‹è¯•APIè°ƒç”¨
            fetch('http://localhost:8000/api/v1/account/query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({})
            })
            .then(res => res.json())
            .then(data => {
                html += `<p class="ok">âœ… APIè°ƒç”¨æˆåŠŸ</p>`;
                html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                statusDiv.innerHTML = html;
            })
            .catch(err => {
                html += `<p class="error">âŒ APIè°ƒç”¨å¤±è´¥: ${err.message}</p>`;
                html += `<p>å¯èƒ½åŸå› ï¼šTokenå·²è¿‡æœŸæˆ–æ— æ•ˆ</p>`;
                statusDiv.innerHTML = html;
            });
        }

        statusDiv.innerHTML = html;
    </script>
</body>
</html>
