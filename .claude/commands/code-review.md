# 代码审查

提交前的全面代码审查，检查质量、安全、性能和规范。

---

请对 $ARGUMENTS 进行代码审查：

## 审查范围
- 如果是文件路径，审查该文件
- 如果是目录，审查目录下所有代码
- 如果为空，审查最近修改的文件

## 审查维度

### 1. 架构合规性 (P0)
- 是否符合 ARCHITECTURE.md 规范
- 层次职责是否清晰
- 是否使用了正确的设计模式

### 2. 安全性检查 (P0)
- SQL 注入风险
- XSS 风险
- 权限验证是否完整
- 敏感数据处理
- 输入验证

### 3. 代码质量 (P1)
- 命名是否清晰
- 函数是否过长（>50行）
- 复杂度是否过高
- 是否有重复代码
- 注释是否充分

### 4. 错误处理 (P1)
- 异常是否正确捕获
- 错误信息是否友好
- 是否有资源泄漏风险

### 5. 性能考虑 (P2)
- N+1 查询问题
- 不必要的数据库调用
- 大数据量处理
- 缓存使用

### 6. 测试覆盖 (P1)
- 是否有对应测试
- 测试是否充分
- 边界条件是否覆盖

### 7. 文档完整性 (P2)
- API 文档是否完整
- 代码注释是否充分
- README 是否更新

## 输出格式

```
## 代码审查报告

### 📁 审查范围
- **文件**: {文件列表}
- **代码行数**: X 行
- **审查时间**: {时间}

### 📊 总体评分
| 维度 | 评分 | 说明 |
|------|------|------|
| 架构合规 | ⭐⭐⭐⭐⭐ | 完全符合规范 |
| 安全性 | ⭐⭐⭐⭐☆ | 有小问题 |
| 代码质量 | ⭐⭐⭐☆☆ | 需要改进 |
| 错误处理 | ⭐⭐⭐⭐⭐ | 良好 |
| 性能 | ⭐⭐⭐⭐☆ | 可以优化 |
| 测试覆盖 | ⭐⭐⭐☆☆ | 需补充测试 |

**综合评分**: X/10

---

### 🔴 必须修复 (P0)

#### 问题 1: {问题标题}
- **位置**: `file.py:42`
- **类型**: 安全/架构
- **描述**: {详细描述}
- **风险**: {潜在风险}
- **修复**:
```python
# 修复前
{问题代码}

# 修复后
{正确代码}
```

---

### 🟡 建议修复 (P1)

#### 问题 2: {问题标题}
- **位置**: `file.py:100`
- **类型**: 代码质量
- **描述**: {详细描述}
- **建议**:
```python
{改进建议}
```

---

### 🟢 可选优化 (P2)

#### 优化 1: {优化标题}
- **位置**: `file.py:200`
- **类型**: 性能
- **当前**: {当前实现}
- **建议**: {优化方案}
- **收益**: {预期收益}

---

### ✅ 优秀实践

值得表扬的代码实践：

1. **良好的错误处理** (`file.py:50-60`)
   - 异常分类清晰
   - 错误信息有意义

2. **清晰的业务逻辑** (`file.py:100-150`)
   - Converter 职责单一
   - 计算逻辑易于理解

---

### 📋 审查检查清单

#### 提交前必须确认
- [ ] 所有 P0 问题已修复
- [ ] 通过 `python scripts/check_architecture.py`
- [ ] 有对应的测试用例
- [ ] API 文档已更新

#### 建议确认
- [ ] P1 问题已修复
- [ ] 代码已格式化
- [ ] 无调试代码残留

---

### 📝 审查总结

**主要问题**:
1. {问题1}
2. {问题2}

**改进建议**:
1. {建议1}
2. {建议2}

**是否可以合并**: {是/否/修复后可以}
```

## 使用示例
- `/code-review backend/app/services/account/` - 审查账户模块
- `/code-review` - 审查最近修改的文件
- `/code-review backend/app/api/v1/event_api.py` - 审查特定文件
