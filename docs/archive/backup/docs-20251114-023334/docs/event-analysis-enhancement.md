# äº‹ä»¶åˆ†æå¢å¼ºè®¾è®¡

**ç‰ˆæœ¬**: v1.0
**æ—¥æœŸ**: 2025-01-14
**ç›®æ ‡**: åœ¨ç°æœ‰æ¶æ„åŸºç¡€ä¸Šå¢å¼ºäº‹ä»¶(æ”¿ç­–äº‹ä»¶ã€å…¬å¸äº‹ä»¶ã€å¸‚åœºäº‹ä»¶ã€è¡Œä¸šäº‹ä»¶)çš„è¿½è¸ªã€åˆ†ç±»ä¸å½±å“åˆ†æèƒ½åŠ›,è®©AIèƒ½å¤Ÿå‚è€ƒè¿™äº›äº‹ä»¶æ¥åˆ†ææ•´ä¸ªè‚¡å¸‚å’Œä¸ªè‚¡

---

## 1. è®¾è®¡ç›®æ ‡

### 1.1 æ ¸å¿ƒéœ€æ±‚
- **äº‹ä»¶æ”¶é›†**: è‡ªåŠ¨ä»MCPæ•°æ®æºæ”¶é›†æ”¿ç­–ã€å…¬å¸ã€å¸‚åœºã€è¡Œä¸šç›¸å…³äº‹ä»¶
- **äº‹ä»¶åˆ†ç±»**: æ™ºèƒ½åˆ†ç±»äº‹ä»¶ç±»å‹ã€é‡è¦æ€§ã€å½±å“èŒƒå›´
- **å½±å“åˆ†æ**: åˆ†æäº‹ä»¶å¯¹æ•´ä½“å¸‚åœºå’Œä¸ªè‚¡çš„å½±å“
- **AIé›†æˆ**: åœ¨AIåˆ†æ(æŒä»“åˆ†æã€é€‰è‚¡ã€ç­–ç•¥ç”Ÿæˆ)æ—¶è‡ªåŠ¨å¼•ç”¨ç›¸å…³äº‹ä»¶

### 1.2 äº‹ä»¶ç±»å‹å®šä¹‰

#### æ”¿ç­–äº‹ä»¶ (Policy Events)
- **è´§å¸æ”¿ç­–**: åˆ©ç‡è°ƒæ•´ã€å­˜æ¬¾å‡†å¤‡é‡‘ç‡ã€è´§å¸ä¾›åº”é‡
- **è´¢æ”¿æ”¿ç­–**: å‡ç¨ã€è¡¥è´´ã€æ”¿åºœæ”¯å‡º
- **ç›‘ç®¡æ”¿ç­–**: è¡Œä¸šç›‘ç®¡è§„åˆ™ã€ä¸Šå¸‚è§„åˆ™ã€äº¤æ˜“è§„åˆ™
- **å›½é™…æ”¿ç­–**: è´¸æ˜“æ”¿ç­–ã€å…³ç¨ã€å›½é™…åè®®

#### å…¬å¸äº‹ä»¶ (Company Events)
- **è´¢æŠ¥ç›¸å…³**: è´¢æŠ¥å‘å¸ƒã€ä¸šç»©é¢„å‘Šã€ä¸šç»©ä¿®æ­£
- **å…¬å¸æ²»ç†**: é«˜ç®¡å˜åŠ¨ã€è‘£äº‹ä¼šå†³è®®ã€è‚¡ä¸œå¤§ä¼š
- **èµ„æœ¬è¿ä½œ**: å¹¶è´­ã€é‡ç»„ã€å¢å‘ã€å›è´­ã€åˆ†çº¢
- **ä¸šåŠ¡å˜åŒ–**: æ–°äº§å“å‘å¸ƒã€é‡å¤§åˆåŒã€äº§èƒ½æ‰©å¼ 

#### å¸‚åœºäº‹ä»¶ (Market Events)
- **æŒ‡æ•°è°ƒæ•´**: æŒ‡æ•°æˆåˆ†è‚¡è°ƒæ•´ã€æƒé‡å˜åŒ–
- **èµ„é‡‘æµåŠ¨**: åŒ—å‘èµ„é‡‘ã€å¤–èµ„æµå…¥æµå‡ºã€å¤§å®—äº¤æ˜“
- **å¸‚åœºæƒ…ç»ª**: VIXæŒ‡æ•°ã€ææ…ŒæŒ‡æ•°ã€æŠ•èµ„è€…æƒ…ç»ªæŒ‡æ ‡
- **æŠ€æœ¯çªç ´**: å…³é”®ç‚¹ä½çªç ´ã€è¶‹åŠ¿å˜åŒ–

#### è¡Œä¸šäº‹ä»¶ (Industry Events)
- **æŠ€æœ¯çªç ´**: æ–°æŠ€æœ¯å‘å¸ƒã€ä¸“åˆ©çªç ´
- **ç«äº‰æ ¼å±€**: å¸‚åœºä»½é¢å˜åŒ–ã€æ–°è¿›å…¥è€…
- **ä¾›éœ€å…³ç³»**: åŸææ–™ä»·æ ¼ã€äº§èƒ½å˜åŒ–ã€éœ€æ±‚å˜åŒ–
- **æ”¿ç­–å½±å“**: è¡Œä¸šä¸“é¡¹æ”¿ç­–ã€è¡¥è´´ã€é™åˆ¶

---

## 2. æ•°æ®åº“è®¾è®¡

### 2.1 äº‹ä»¶è¡¨ (events)

```sql
-- äº‹ä»¶ç±»å‹æšä¸¾
CREATE TYPE event_category AS ENUM (
  'policy',        -- æ”¿ç­–äº‹ä»¶
  'company',       -- å…¬å¸äº‹ä»¶
  'market',        -- å¸‚åœºäº‹ä»¶
  'industry'       -- è¡Œä¸šäº‹ä»¶
);

-- äº‹ä»¶å­ç±»å‹
CREATE TYPE event_subcategory AS ENUM (
  -- æ”¿ç­–äº‹ä»¶å­ç±»å‹
  'policy_monetary',    -- è´§å¸æ”¿ç­–
  'policy_fiscal',      -- è´¢æ”¿æ”¿ç­–
  'policy_regulatory',  -- ç›‘ç®¡æ”¿ç­–
  'policy_international', -- å›½é™…æ”¿ç­–

  -- å…¬å¸äº‹ä»¶å­ç±»å‹
  'company_earnings',   -- è´¢æŠ¥ç›¸å…³
  'company_governance', -- å…¬å¸æ²»ç†
  'company_capital',    -- èµ„æœ¬è¿ä½œ
  'company_business',   -- ä¸šåŠ¡å˜åŒ–

  -- å¸‚åœºäº‹ä»¶å­ç±»å‹
  'market_index',       -- æŒ‡æ•°è°ƒæ•´
  'market_flow',        -- èµ„é‡‘æµåŠ¨
  'market_sentiment',   -- å¸‚åœºæƒ…ç»ª
  'market_technical',   -- æŠ€æœ¯çªç ´

  -- è¡Œä¸šäº‹ä»¶å­ç±»å‹
  'industry_tech',      -- æŠ€æœ¯çªç ´
  'industry_competition', -- ç«äº‰æ ¼å±€
  'industry_supply',    -- ä¾›éœ€å…³ç³»
  'industry_policy'     -- è¡Œä¸šæ”¿ç­–
);

-- äº‹ä»¶é‡è¦æ€§çº§åˆ«
CREATE TYPE event_importance AS ENUM (
  'critical',    -- æå…¶é‡è¦(å½±å“æ•´ä¸ªå¸‚åœº)
  'high',        -- é«˜åº¦é‡è¦(å½±å“è¡Œä¸šæˆ–å¤§ç›˜è‚¡)
  'medium',      -- ä¸­åº¦é‡è¦(å½±å“ä¸ªè‚¡æˆ–æ¿å—)
  'low'          -- ä½åº¦é‡è¦(å‚è€ƒæ€§äº‹ä»¶)
);

-- äº‹ä»¶å½±å“æ–¹å‘
CREATE TYPE event_impact_direction AS ENUM (
  'positive',    -- åˆ©å¥½
  'negative',    -- åˆ©ç©º
  'neutral',     -- ä¸­æ€§
  'mixed'        -- å¤æ‚å½±å“
);

-- äº‹ä»¶è¡¨
CREATE TABLE events (
  id BIGSERIAL PRIMARY KEY,                                    -- äº‹ä»¶ID

  -- åŸºæœ¬ä¿¡æ¯
  title TEXT NOT NULL,                                         -- äº‹ä»¶æ ‡é¢˜
  summary TEXT NOT NULL,                                       -- äº‹ä»¶æ‘˜è¦(200-500å­—)
  content TEXT,                                                -- äº‹ä»¶è¯¦ç»†å†…å®¹
  source_url TEXT,                                             -- æ¥æºé“¾æ¥

  -- åˆ†ç±»ä¿¡æ¯
  category event_category NOT NULL,                            -- ä¸»åˆ†ç±»
  subcategory event_subcategory NOT NULL,                      -- å­åˆ†ç±»
  importance event_importance NOT NULL DEFAULT 'medium',       -- é‡è¦æ€§çº§åˆ«

  -- å½±å“èŒƒå›´
  symbols TEXT[],                                              -- å—å½±å“çš„è‚¡ç¥¨ä»£ç åˆ—è¡¨(å¯ä¸ºç©ºè¡¨ç¤ºå¸‚åœºçº§äº‹ä»¶)
  sectors TEXT[],                                              -- å—å½±å“çš„è¡Œä¸šåˆ—è¡¨
  markets TEXT[],                                              -- å—å½±å“çš„å¸‚åœº(å¦‚['CN','US','HK'])

  -- å½±å“åˆ†æ
  impact_direction event_impact_direction DEFAULT 'neutral',   -- å½±å“æ–¹å‘
  impact_magnitude NUMERIC(5,2),                               -- å½±å“å¼ºåº¦(0-100,ç”±AIè¯„ä¼°)
  impact_summary TEXT,                                         -- å½±å“æ‘˜è¦(AIç”Ÿæˆ)

  -- æ—¶é—´ä¿¡æ¯
  event_time TIMESTAMPTZ NOT NULL,                             -- äº‹ä»¶å‘ç”Ÿæ—¶é—´
  published_at TIMESTAMPTZ,                                    -- äº‹ä»¶å‘å¸ƒæ—¶é—´
  impact_start_date DATE,                                      -- å½±å“å¼€å§‹æ—¥æœŸ
  impact_end_date DATE,                                        -- å½±å“ç»“æŸæ—¥æœŸ(å¯ä¸ºç©ºè¡¨ç¤ºæŒç»­å½±å“)

  -- æ•°æ®æº
  source TEXT NOT NULL DEFAULT 'mcp',                          -- æ•°æ®æº(mcp/manual/user)
  external_id TEXT,                                            -- å¤–éƒ¨äº‹ä»¶ID(ç”¨äºå»é‡)

  -- å®¡è®¡
  processed BOOLEAN DEFAULT FALSE,                             -- æ˜¯å¦å·²å¤„ç†(AIåˆ†æ)
  idempotency_key TEXT UNIQUE,                                 -- å¹‚ç­‰é”®(é¿å…é‡å¤)
  created_at TIMESTAMPTZ DEFAULT NOW(),                        -- åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMPTZ DEFAULT NOW()                         -- æ›´æ–°æ—¶é—´
);

-- ç´¢å¼•
CREATE INDEX idx_events_category ON events(category, event_time DESC);
CREATE INDEX idx_events_importance ON events(importance, event_time DESC);
CREATE INDEX idx_events_symbols ON events USING GIN(symbols);               -- GINç´¢å¼•æ”¯æŒæ•°ç»„æŸ¥è¯¢
CREATE INDEX idx_events_sectors ON events USING GIN(sectors);
CREATE INDEX idx_events_time ON events(event_time DESC);
CREATE INDEX idx_events_processed ON events(processed, event_time DESC);
CREATE INDEX idx_events_external_id ON events(external_id);

COMMENT ON TABLE events IS 'äº‹ä»¶è¡¨:è¿½è¸ªæ”¿ç­–ã€å…¬å¸ã€å¸‚åœºã€è¡Œä¸šäº‹ä»¶';
COMMENT ON COLUMN events.impact_magnitude IS 'å½±å“å¼ºåº¦(0-100),ç”±AIè¯„ä¼°,æ•°å€¼è¶Šå¤§å½±å“è¶Šå¤§';
COMMENT ON COLUMN events.symbols IS 'å—å½±å“çš„è‚¡ç¥¨ä»£ç åˆ—è¡¨,ç©ºæ•°ç»„è¡¨ç¤ºå¸‚åœºçº§äº‹ä»¶';
```

### 2.2 äº‹ä»¶ä¸è‚¡ç¥¨å…³è”åˆ†æè¡¨ (event_stock_impacts)

```sql
-- äº‹ä»¶å¯¹ä¸ªè‚¡çš„å½±å“è¯¦ç»†åˆ†æ
CREATE TABLE event_stock_impacts (
  id BIGSERIAL PRIMARY KEY,                                    -- è®°å½•ID
  event_id BIGINT NOT NULL,                                    -- äº‹ä»¶ID(å¼•ç”¨ events.id,è™šæ‹Ÿå¤–é”®)
  symbol TEXT NOT NULL,                                        -- è‚¡ç¥¨ä»£ç 

  -- å½±å“åˆ†æ
  impact_direction event_impact_direction NOT NULL,            -- å¯¹è¯¥è‚¡ç¥¨çš„å½±å“æ–¹å‘
  impact_magnitude NUMERIC(5,2),                               -- å¯¹è¯¥è‚¡ç¥¨çš„å½±å“å¼ºåº¦(0-100)
  impact_reason TEXT,                                          -- å½±å“åŸå› (AIç”Ÿæˆ)

  -- ä»·æ ¼å½±å“é¢„æµ‹
  expected_price_change_percent NUMERIC(9,4),                  -- é¢„æœŸä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
  actual_price_change_percent NUMERIC(9,4),                    -- å®é™…ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”(äº‹åå¡«å……)

  -- æ—¶é—´ä¿¡æ¯
  analyzed_at TIMESTAMPTZ DEFAULT NOW(),                       -- åˆ†ææ—¶é—´

  UNIQUE(event_id, symbol)                                     -- æ¯ä¸ªäº‹ä»¶å¯¹æ¯åªè‚¡ç¥¨åªæœ‰ä¸€æ¡åˆ†æè®°å½•
);

CREATE INDEX idx_event_impacts_symbol ON event_stock_impacts(symbol, analyzed_at DESC);
CREATE INDEX idx_event_impacts_event ON event_stock_impacts(event_id);
CREATE INDEX idx_event_impacts_direction ON event_stock_impacts(impact_direction, impact_magnitude DESC);

COMMENT ON TABLE event_stock_impacts IS 'äº‹ä»¶å¯¹ä¸ªè‚¡çš„å½±å“è¯¦ç»†åˆ†æ';
```

### 2.3 æ‰©å±•ç°æœ‰è¡¨ç»“æ„

#### åœ¨ `strategy_analysis` è¡¨ä¸­æ·»åŠ äº‹ä»¶å¼•ç”¨

```sql
-- æ·»åŠ å­—æ®µåˆ°ç°æœ‰çš„ strategy_analysis è¡¨
ALTER TABLE strategy_analysis
  ADD COLUMN related_events JSONB;  -- ç›¸å…³äº‹ä»¶åˆ—è¡¨ [{"event_id": 123, "relevance": 0.85}]

CREATE INDEX idx_strategy_related_events ON strategy_analysis USING GIN(related_events);

COMMENT ON COLUMN strategy_analysis.related_events IS 'ç­–ç•¥åˆ†ææ—¶å‚è€ƒçš„ç›¸å…³äº‹ä»¶åˆ—è¡¨';
```

#### åœ¨ `ai_analysis_history` è¡¨ä¸­æ·»åŠ äº‹ä»¶å¼•ç”¨

```sql
-- æ·»åŠ å­—æ®µåˆ°ç°æœ‰çš„ ai_analysis_history è¡¨
ALTER TABLE ai_analysis_history
  ADD COLUMN related_events JSONB;  -- åˆ†ææ—¶å‚è€ƒçš„äº‹ä»¶åˆ—è¡¨

CREATE INDEX idx_ai_history_events ON ai_analysis_history USING GIN(related_events);

COMMENT ON COLUMN ai_analysis_history.related_events IS 'AIåˆ†ææ—¶å‚è€ƒçš„äº‹ä»¶åˆ—è¡¨';
```

---

## 3. æ¶æ„è®¾è®¡

### 3.1 Adapterå±‚æ‰©å±•

#### EventAdapter (æ–°å¢)

```typescript
/**
 * EventAdapter: äº‹ä»¶æ•°æ®é€‚é…å™¨
 * èŒè´£:
 * 1. ä»MCPæœåŠ¡è·å–å„ç±»äº‹ä»¶æ•°æ®
 * 2. ç»Ÿä¸€äº‹ä»¶æ•°æ®æ ¼å¼
 * 3. äº‹ä»¶å»é‡ä¸å¹‚ç­‰æ€§ä¿è¯
 */
export class EventAdapter {
  /**
   * è·å–æœ€æ–°äº‹ä»¶(æŒ‡å®šæ—¶é—´çª—å£)
   */
  static async fetchRecentEvents(params: {
    startTime: Date;
    endTime?: Date;
    categories?: EventCategory[];
    symbols?: string[];
    markets?: string[];
  }): Promise<EventData[]>;

  /**
   * è·å–å•ä¸ªè‚¡ç¥¨ç›¸å…³äº‹ä»¶
   */
  static async fetchSymbolEvents(
    symbol: string,
    lookbackDays: number
  ): Promise<EventData[]>;

  /**
   * è·å–è¡Œä¸šç›¸å…³äº‹ä»¶
   */
  static async fetchSectorEvents(
    sector: string,
    lookbackDays: number
  ): Promise<EventData[]>;

  /**
   * è·å–å¸‚åœºçº§äº‹ä»¶
   */
  static async fetchMarketEvents(
    market: string,
    lookbackDays: number
  ): Promise<EventData[]>;
}
```

#### NewsAdapterå¢å¼º (ç°æœ‰)

```typescript
/**
 * NewsAdapter: æ–°é—»ä¸èˆ†æƒ…é€‚é…å™¨(å¢å¼º)
 * èŒè´£:
 * 1. ä»æ–°é—»ä¸­è¯†åˆ«å’Œæå–äº‹ä»¶
 * 2. ä¸EventAdapteré…åˆ,å°†æ–°é—»è½¬åŒ–ä¸ºç»“æ„åŒ–äº‹ä»¶
 */
export class NewsAdapter {
  /**
   * ç°æœ‰åŠŸèƒ½ + æ–°å¢: ä»æ–°é—»ä¸­æå–äº‹ä»¶
   */
  static async extractEventsFromNews(
    newsItems: NewsItem[]
  ): Promise<EventData[]>;
}
```

### 3.2 DataServiceå±‚æ‰©å±•

#### EventDataService (æ–°å¢)

```typescript
/**
 * EventDataService: äº‹ä»¶æ•°æ®æœåŠ¡
 * èŒè´£: èšåˆäº‹ä»¶æ•°æ®è®¿é—®,ç»Ÿä¸€ç®¡ç†ç¼“å­˜ç­–ç•¥
 */
export class EventDataService {
  /**
   * è·å–ç›¸å…³äº‹ä»¶(ä¼˜å…ˆè¯»ç¼“å­˜,missæ—¶é€šè¿‡Adapteræ‹‰å–å¹¶è½åº“)
   */
  static async getRelevantEvents(params: {
    symbols?: string[];
    sectors?: string[];
    startDate: Date;
    endDate?: Date;
    importance?: EventImportance[];
    categories?: EventCategory[];
  }): Promise<Event[]>;

  /**
   * ä¿å­˜äº‹ä»¶
   */
  static async saveEvents(events: EventData[]): Promise<void>;

  /**
   * è·å–äº‹ä»¶å½±å“åˆ†æ
   */
  static async getEventImpacts(
    eventId: number,
    symbols?: string[]
  ): Promise<EventStockImpact[]>;

  /**
   * ä¿å­˜äº‹ä»¶å½±å“åˆ†æ
   */
  static async saveEventImpacts(
    impacts: EventStockImpact[]
  ): Promise<void>;
}
```

### 3.3 Serviceå±‚å¢å¼º

#### StrategyServiceå¢å¼º

```typescript
/**
 * StrategyService: ç­–ç•¥æœåŠ¡(å¢å¼º)
 */
export class StrategyService {
  /**
   * ç”Ÿæˆç­–ç•¥åˆ†æ(å¢å¼ºç‰ˆæœ¬,åŒ…å«äº‹ä»¶åˆ†æ)
   */
  static async collectStrategyData(params: {
    userId: number;
    accountId: number;
    symbol: string;
    lookbackDays?: number; // å›æº¯å¤©æ•°,ç”¨äºè·å–å†å²äº‹ä»¶
  }): Promise<StrategyAnalysisData> {
    // 1. è·å–è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
    const company = await MarketDataService.getCompany(symbol);
    const price = await MarketDataService.getPrice(symbol);

    // 2. è·å–ç›¸å…³äº‹ä»¶(è¿‡å»Nå¤©)
    const events = await EventDataService.getRelevantEvents({
      symbols: [symbol],
      sectors: [company.sector],
      startDate: subDays(new Date(), lookbackDays || 30),
      importance: ['critical', 'high', 'medium']
    });

    // 3. AIåˆ†æ(åŒ…å«äº‹ä»¶ä¸Šä¸‹æ–‡)
    const analysis = await this.analyzeWithEvents(
      company,
      price,
      events
    );

    // 4. ä¿å­˜ç­–ç•¥åˆ†æ(å«äº‹ä»¶å¼•ç”¨)
    const strategy = await StrategyAnalysisRepository.save({
      ...analysis,
      related_events: events.map(e => ({
        event_id: e.id,
        relevance: this.calculateRelevance(e, symbol)
      }))
    });

    return strategy;
  }

  /**
   * AIåˆ†æ(åŒ…å«äº‹ä»¶ä¸Šä¸‹æ–‡)
   */
  private static async analyzeWithEvents(
    company: CompanyData,
    price: PriceData,
    events: Event[]
  ): Promise<StrategyAnalysisData> {
    // æ„å»ºåŒ…å«äº‹ä»¶çš„Prompt
    const prompt = this.buildPromptWithEvents(company, price, events);

    // è°ƒç”¨Claude API
    const response = await ClaudeAdapter.analyze(prompt);

    return response;
  }

  /**
   * æ„å»ºåŒ…å«äº‹ä»¶çš„Prompt
   */
  private static buildPromptWithEvents(
    company: CompanyData,
    price: PriceData,
    events: Event[]
  ): string {
    return `
ä½ æ˜¯ä¸“ä¸šçš„æŠ•èµ„åˆ†æå¸ˆã€‚è¯·åˆ†æä»¥ä¸‹è‚¡ç¥¨:

## è‚¡ç¥¨ä¿¡æ¯
- ä»£ç : ${company.symbol}
- åç§°: ${company.name}
- è¡Œä¸š: ${company.sector}
- å½“å‰ä»·æ ¼: ${price.price}
- æ¶¨è·Œå¹…: ${price.changePercent}%

## è¿‘æœŸç›¸å…³äº‹ä»¶
${this.formatEventsForPrompt(events)}

## è¯·æä¾›åˆ†æ:
1. åŸºäºä¸Šè¿°äº‹ä»¶,åˆ†æå¯¹è¯¥è‚¡ç¥¨çš„å½±å“
2. ç»™å‡ºæ“ä½œå»ºè®®(ä¹°å…¥/å–å‡º/æŒæœ‰)
3. è®¾å®šæ­¢æŸä½å’Œç›®æ ‡ä»·
4. è¯„ä¼°é£é™©ç­‰çº§

è¯·ä»¥JSONæ ¼å¼è¿”å›åˆ†æç»“æœã€‚
    `;
  }

  /**
   * æ ¼å¼åŒ–äº‹ä»¶ç”¨äºPrompt
   */
  private static formatEventsForPrompt(events: Event[]): string {
    if (events.length === 0) return 'æš‚æ— é‡å¤§äº‹ä»¶';

    return events.map((e, idx) => `
### äº‹ä»¶${idx + 1}: ${e.title}
- ç±»å‹: ${e.category} / ${e.subcategory}
- é‡è¦æ€§: ${e.importance}
- å½±å“æ–¹å‘: ${e.impactDirection}
- å½±å“å¼ºåº¦: ${e.impactMagnitude}/100
- æ—¶é—´: ${e.eventTime}
- æ‘˜è¦: ${e.summary}
${e.impactSummary ? `- AIåˆ†æ: ${e.impactSummary}` : ''}
    `).join('\n');
  }

  /**
   * è®¡ç®—äº‹ä»¶ç›¸å…³æ€§(0-1)
   */
  private static calculateRelevance(event: Event, symbol: string): number {
    let relevance = 0.5; // åŸºç¡€ç›¸å…³æ€§

    // ç›´æ¥æåˆ°è¯¥è‚¡ç¥¨ +0.4
    if (event.symbols?.includes(symbol)) {
      relevance += 0.4;
    }

    // é‡è¦æ€§åŠ æƒ
    const importanceWeight = {
      'critical': 0.3,
      'high': 0.2,
      'medium': 0.1,
      'low': 0.0
    };
    relevance += importanceWeight[event.importance] || 0;

    return Math.min(relevance, 1.0);
  }
}
```

---

## 4. å®šæ—¶ä»»åŠ¡è®¾è®¡

### 4.1 äº‹ä»¶æ”¶é›†ä»»åŠ¡

```typescript
/**
 * äº‹ä»¶æ”¶é›†å®šæ—¶ä»»åŠ¡
 * é¢‘ç‡: æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
 */
export class EventCollectionTask {
  /**
   * æ‰§è¡Œäº‹ä»¶æ”¶é›†
   */
  async execute(): Promise<void> {
    // 1. è·å–æœ€æ–°äº‹ä»¶(ä»ä¸Šæ¬¡æ”¶é›†æ—¶é—´åˆ°ç°åœ¨)
    const lastCollectionTime = await this.getLastCollectionTime();
    const newEvents = await EventAdapter.fetchRecentEvents({
      startTime: lastCollectionTime,
      endTime: new Date()
    });

    // 2. å»é‡(é€šè¿‡external_idæˆ–idempotency_key)
    const uniqueEvents = this.deduplicateEvents(newEvents);

    // 3. AIå¢å¼º(åˆ†æå½±å“æ–¹å‘ã€å¼ºåº¦ã€æ‘˜è¦)
    const enrichedEvents = await this.enrichEventsWithAI(uniqueEvents);

    // 4. ä¿å­˜åˆ°æ•°æ®åº“
    await EventDataService.saveEvents(enrichedEvents);

    // 5. è§¦å‘ä¸ªè‚¡å½±å“åˆ†æ(å¼‚æ­¥)
    await this.triggerImpactAnalysis(enrichedEvents);

    // 6. æ›´æ–°æ”¶é›†æ—¶é—´æˆ³
    await this.updateLastCollectionTime(new Date());
  }

  /**
   * AIå¢å¼ºäº‹ä»¶åˆ†æ
   */
  private async enrichEventsWithAI(
    events: EventData[]
  ): Promise<EventData[]> {
    // æ‰¹é‡è°ƒç”¨Claude APIåˆ†æäº‹ä»¶å½±å“
    const enriched = await Promise.all(
      events.map(async (event) => {
        const analysis = await ClaudeAdapter.analyzeEvent(event);
        return {
          ...event,
          impactDirection: analysis.direction,
          impactMagnitude: analysis.magnitude,
          impactSummary: analysis.summary
        };
      })
    );

    return enriched;
  }

  /**
   * è§¦å‘ä¸ªè‚¡å½±å“åˆ†æ
   */
  private async triggerImpactAnalysis(
    events: Event[]
  ): Promise<void> {
    for (const event of events) {
      // åªå¯¹é‡è¦äº‹ä»¶è¿›è¡Œè¯¦ç»†å½±å“åˆ†æ
      if (event.importance === 'critical' || event.importance === 'high') {
        await AgentTasksService.createTask({
          taskType: 'event_impact_analysis',
          payload: { eventId: event.id }
        });
      }
    }
  }
}
```

### 4.2 äº‹ä»¶å½±å“åˆ†æä»»åŠ¡

```typescript
/**
 * äº‹ä»¶å½±å“åˆ†æä»»åŠ¡
 * è§¦å‘æ–¹å¼: äº‹ä»¶æ”¶é›†åå¼‚æ­¥æ‰§è¡Œ
 */
export class EventImpactAnalysisTask {
  /**
   * åˆ†æäº‹ä»¶å¯¹ç›¸å…³è‚¡ç¥¨çš„å½±å“
   */
  async execute(eventId: number): Promise<void> {
    // 1. è·å–äº‹ä»¶
    const event = await EventRepository.findById(eventId);

    // 2. ç¡®å®šå—å½±å“çš„è‚¡ç¥¨åˆ—è¡¨
    const affectedSymbols = await this.getAffectedSymbols(event);

    // 3. å¯¹æ¯åªè‚¡ç¥¨è¿›è¡Œå½±å“åˆ†æ
    const impacts = await Promise.all(
      affectedSymbols.map(symbol =>
        this.analyzeImpactOnSymbol(event, symbol)
      )
    );

    // 4. ä¿å­˜å½±å“åˆ†æç»“æœ
    await EventDataService.saveEventImpacts(impacts);

    // 5. æ ‡è®°äº‹ä»¶ä¸ºå·²å¤„ç†
    await EventRepository.update(eventId, { processed: true });
  }

  /**
   * è·å–å—å½±å“çš„è‚¡ç¥¨åˆ—è¡¨
   */
  private async getAffectedSymbols(event: Event): Promise<string[]> {
    const symbols = new Set<string>();

    // 1. äº‹ä»¶ä¸­ç›´æ¥æåˆ°çš„è‚¡ç¥¨
    if (event.symbols) {
      event.symbols.forEach(s => symbols.add(s));
    }

    // 2. äº‹ä»¶å½±å“çš„è¡Œä¸šä¸­çš„è‚¡ç¥¨(å–å‰Nåª)
    if (event.sectors && event.sectors.length > 0) {
      const sectorStocks = await CompanyRepository.findBySectors(
        event.sectors,
        { limit: 50 } // æ¯ä¸ªè¡Œä¸šå–å‰50åª
      );
      sectorStocks.forEach(s => symbols.add(s.symbol));
    }

    return Array.from(symbols);
  }

  /**
   * åˆ†æäº‹ä»¶å¯¹å•åªè‚¡ç¥¨çš„å½±å“
   */
  private async analyzeImpactOnSymbol(
    event: Event,
    symbol: string
  ): Promise<EventStockImpact> {
    // è·å–è‚¡ç¥¨ä¿¡æ¯
    const company = await MarketDataService.getCompany(symbol);
    const price = await MarketDataService.getPrice(symbol);

    // AIåˆ†æå½±å“
    const analysis = await ClaudeAdapter.analyzeEventImpact({
      event,
      company,
      price
    });

    return {
      eventId: event.id,
      symbol,
      impactDirection: analysis.direction,
      impactMagnitude: analysis.magnitude,
      impactReason: analysis.reason,
      expectedPriceChangePercent: analysis.expectedChange
    };
  }
}
```

---

## 5. APIè®¾è®¡

### 5.1 äº‹ä»¶ç®¡ç†API

```typescript
// è·å–äº‹ä»¶åˆ—è¡¨
GET /api/events
Query params:
  - category?: EventCategory
  - subcategory?: EventSubcategory
  - importance?: EventImportance
  - symbol?: string
  - sector?: string
  - startDate?: Date
  - endDate?: Date
  - page?: number
  - limit?: number

Response: {
  events: Event[];
  total: number;
  page: number;
  totalPages: number;
}

// è·å–å•ä¸ªäº‹ä»¶è¯¦æƒ…
GET /api/events/:id
Response: {
  event: Event;
  impacts: EventStockImpact[];  // å¯¹ä¸ªè‚¡çš„å½±å“åˆ†æ
}

// è·å–è‚¡ç¥¨ç›¸å…³äº‹ä»¶
GET /api/stocks/:symbol/events
Query params:
  - lookbackDays?: number (default: 30)
  - importance?: EventImportance[]

Response: {
  symbol: string;
  events: Event[];
  total: number;
}

// æ‰‹åŠ¨è§¦å‘äº‹ä»¶æ”¶é›†
POST /api/events/collect
Request: {
  startTime?: Date;
  categories?: EventCategory[];
}
Response: {
  collected: number;
  processed: number;
}

// æ‰‹åŠ¨æ·»åŠ äº‹ä»¶
POST /api/events
Request: {
  title: string;
  summary: string;
  content?: string;
  category: EventCategory;
  subcategory: EventSubcategory;
  importance: EventImportance;
  symbols?: string[];
  sectors?: string[];
  eventTime: Date;
}
Response: {
  event: Event;
}
```

### 5.2 å¢å¼ºçš„AIåˆ†æAPI

```typescript
// æŒä»“åˆ†æ(å¢å¼ºç‰ˆ,åŒ…å«äº‹ä»¶åˆ†æ)
POST /api/ai/analyze/portfolio
Request: {
  accountId: number;
  includeEvents: boolean;      // æ˜¯å¦åŒ…å«äº‹ä»¶åˆ†æ
  eventLookbackDays?: number;  // äº‹ä»¶å›æº¯å¤©æ•°
}
Response: {
  summary: {...};
  holdings_analysis: [
    {
      symbol: string;
      ...
      relatedEvents: Event[];  // ç›¸å…³äº‹ä»¶
    }
  ];
  portfolio_advice: {...};
  marketEvents: Event[];       // å¸‚åœºçº§äº‹ä»¶
}

// å•è‚¡åˆ†æ(å¢å¼ºç‰ˆ,åŒ…å«äº‹ä»¶åˆ†æ)
POST /api/ai/analyze/stock
Request: {
  symbol: string;
  accountId?: number;
  includeEvents: boolean;
  eventLookbackDays?: number;
}
Response: {
  ...
  relatedEvents: Event[];      // ç›¸å…³äº‹ä»¶
  eventAnalysis: {             // äº‹ä»¶å½±å“åˆ†æ
    positiveEvents: Event[];
    negativeEvents: Event[];
    overallImpact: string;
  };
}
```

---

## 6. å‰ç«¯UIè®¾è®¡

### 6.1 äº‹ä»¶ä¸­å¿ƒé¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹ä»¶ä¸­å¿ƒ                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç­›é€‰] ç±»å‹: [å…¨éƒ¨â–¼] é‡è¦æ€§: [å…¨éƒ¨â–¼] æ—¶é—´: [30å¤©â–¼]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ [æé‡è¦] å¤®è¡Œé™æ¯50ä¸ªåŸºç‚¹                         â”‚
â”‚    æ”¿ç­–äº‹ä»¶ > è´§å¸æ”¿ç­– | 2025-01-14 10:30           â”‚
â”‚    å½±å“: åˆ©å¥½ (85/100) | å¸‚åœºçº§äº‹ä»¶                 â”‚
â”‚    ğŸ“Š å½±å“25åªè‚¡ç¥¨ | ğŸ’¡ æŸ¥çœ‹è¯¦æƒ…                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ  [é«˜åº¦é‡è¦] è‹¹æœå…¬å¸å‘å¸ƒQ4è´¢æŠ¥è¶…é¢„æœŸ               â”‚
â”‚    å…¬å¸äº‹ä»¶ > è´¢æŠ¥ç›¸å…³ | 2025-01-13 16:00           â”‚
â”‚    å½±å“: åˆ©å¥½ (78/100) | AAPL                       â”‚
â”‚    ğŸ“Š æŸ¥çœ‹å½±å“åˆ†æ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ [ä¸­åº¦é‡è¦] åŠå¯¼ä½“è¡Œä¸šè¡¥è´´æ”¿ç­–å‡ºå°                 â”‚
â”‚    è¡Œä¸šäº‹ä»¶ > è¡Œä¸šæ”¿ç­– | 2025-01-12 09:00           â”‚
â”‚    å½±å“: åˆ©å¥½ (65/100) | å½±å“ç§‘æŠ€æ¿å—               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è‚¡ç¥¨è¯¦æƒ…é¡µ - äº‹ä»¶åŒºå—(æ–°å¢)

åœ¨ç°æœ‰è‚¡ç¥¨è¯¦æƒ…é¡µå¢åŠ "ç›¸å…³äº‹ä»¶"åŒºå—:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AAPL - è‹¹æœå…¬å¸                                      â”‚
â”‚ å½“å‰ä»·æ ¼: $180.50 (+2.3%)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¬å¸ä¿¡æ¯] [ä»·æ ¼èµ°åŠ¿] [ç›¸å…³äº‹ä»¶] [ç­–ç•¥åˆ†æ]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“… è¿‘30å¤©ç›¸å…³äº‹ä»¶ (5æ¡)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… 2025-01-13 | Q4è´¢æŠ¥è¶…é¢„æœŸ                        â”‚
â”‚    åˆ©å¥½ (78/100) | AIåˆ†æ: æœåŠ¡ä¸šåŠ¡å¢é•¿å¼ºåŠ²...      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ 2025-01-10 | æ¬§ç›Ÿåå„æ–­è°ƒæŸ¥å‡çº§                  â”‚
â”‚    åˆ©ç©º (45/100) | AIåˆ†æ: å¯èƒ½é¢ä¸´ç½šæ¬¾...          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸ 2025-01-08 | ç¾è”å‚¨ç»´æŒåˆ©ç‡ä¸å˜                  â”‚
â”‚    ä¸­æ€§ (20/100) | å¸‚åœºçº§äº‹ä»¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 æŒä»“åˆ†æç»“æœ - äº‹ä»¶å¡ç‰‡(å¢å¼º)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒä»“åˆ†æç»“æœ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æ•´ä½“è¯„ä¼°                                          â”‚
â”‚ æ€»å¸‚å€¼: Â¥500,000 | ç›ˆäº: +Â¥50,000 (+11%)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”” é‡è¦äº‹ä»¶æé†’                                      â”‚
â”‚ â€¢ å¤®è¡Œé™æ¯ â†’ åˆ©å¥½æ‚¨æŒæœ‰çš„é“¶è¡Œè‚¡å’Œåœ°äº§è‚¡              â”‚
â”‚ â€¢ ç§‘æŠ€è¡¥è´´æ”¿ç­– â†’ åˆ©å¥½æ‚¨æŒæœ‰çš„AAPLã€MSFT             â”‚
â”‚ â€¢ è´¸æ˜“æ‘©æ“¦å‡çº§ â†’ æ³¨æ„é£é™©(æŒä»“ä¸­æœ‰XXè‚¡)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ ä¸ªè‚¡å»ºè®® (åŸºäºäº‹ä»¶åˆ†æ)                           â”‚
â”‚ AAPL | æŒæœ‰ | è´¢æŠ¥è¶…é¢„æœŸ,å»ºè®®ç»§ç»­æŒæœ‰               â”‚
â”‚ MSFT | åŠ ä»“ | å—ç›ŠäºAIæ”¿ç­–,å»ºè®®é€‚å½“åŠ ä»“             â”‚
â”‚ XXX  | å‡ä»“ | å—è´¸æ˜“æ‘©æ“¦å½±å“,å»ºè®®å‡ä»“è§‚æœ›            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®åº“ä¸åŸºç¡€è®¾æ–½ (1å‘¨)
- [ ] åˆ›å»ºäº‹ä»¶è¡¨ç»“æ„(events, event_stock_impacts)
- [ ] æ‰©å±•ç°æœ‰è¡¨(strategy_analysis, ai_analysis_history)
- [ ] ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] åˆ›å»ºRepositoryå±‚(EventRepository)

### Phase 2: Adapterä¸DataService (1-2å‘¨)
- [ ] å®ç°EventAdapter(MCPé›†æˆ)
- [ ] å¢å¼ºNewsAdapter(äº‹ä»¶æå–)
- [ ] å®ç°EventDataService
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

### Phase 3: Serviceå±‚ä¸AIé›†æˆ (2å‘¨)
- [ ] å¢å¼ºStrategyService(åŒ…å«äº‹ä»¶åˆ†æ)
- [ ] å¢å¼ºStockService
- [ ] å®ç°äº‹ä»¶æ”¶é›†å®šæ—¶ä»»åŠ¡
- [ ] å®ç°äº‹ä»¶å½±å“åˆ†æä»»åŠ¡
- [ ] AI Promptä¼˜åŒ–(åŒ…å«äº‹ä»¶ä¸Šä¸‹æ–‡)

### Phase 4: APIä¸å‰ç«¯ (2å‘¨)
- [ ] å®ç°äº‹ä»¶ç®¡ç†API
- [ ] å¢å¼ºAIåˆ†æAPI(è¿”å›äº‹ä»¶æ•°æ®)
- [ ] å‰ç«¯äº‹ä»¶ä¸­å¿ƒé¡µé¢
- [ ] å‰ç«¯è‚¡ç¥¨è¯¦æƒ…é¡µäº‹ä»¶åŒºå—
- [ ] å‰ç«¯æŒä»“åˆ†æç»“æœäº‹ä»¶å¡ç‰‡

### Phase 5: æµ‹è¯•ä¸ä¼˜åŒ– (1å‘¨)
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–(ç¼“å­˜ã€ç´¢å¼•)
- [ ] AIåˆ†æè´¨é‡è¯„ä¼°
- [ ] æ–‡æ¡£å®Œå–„

---

## 8. æŠ€æœ¯è¦ç‚¹

### 8.1 äº‹ä»¶å»é‡ç­–ç•¥
- ä½¿ç”¨`external_id`ä½œä¸ºå¤–éƒ¨äº‹ä»¶å”¯ä¸€æ ‡è¯†
- ä½¿ç”¨`idempotency_key`é˜²æ­¢é‡å¤å¯¼å…¥
- ç›¸ä¼¼äº‹ä»¶åˆå¹¶(æ ‡é¢˜ç›¸ä¼¼åº¦>80%ä¸”æ—¶é—´å·®<24h)

### 8.2 AIåˆ†æä¼˜åŒ–
- æ‰¹é‡åˆ†æ(ä¸€æ¬¡APIè°ƒç”¨åˆ†æå¤šä¸ªäº‹ä»¶)
- ç¼“å­˜äº‹ä»¶å½±å“åˆ†æç»“æœ(24å°æ—¶TTL)
- æ¸è¿›å¼åˆ†æ(criticaläº‹ä»¶ä¼˜å…ˆ,lowäº‹ä»¶å»¶å)

### 8.3 æ€§èƒ½ä¼˜åŒ–
- äº‹ä»¶è¡¨æŒ‰æ—¶é—´åˆ†åŒº(æœˆåº¦åˆ†åŒº)
- GINç´¢å¼•ä¼˜åŒ–æ•°ç»„æŸ¥è¯¢(symbols, sectors)
- Redisç¼“å­˜çƒ­ç‚¹äº‹ä»¶(7å¤©å†…çš„critical/highäº‹ä»¶)
- ç‰©åŒ–è§†å›¾ç¼“å­˜è‚¡ç¥¨-äº‹ä»¶å…³è”

### 8.4 æ•°æ®è´¨é‡ä¿è¯
- AIåˆ†æç»“æœç½®ä¿¡åº¦è¯„åˆ†
- äººå·¥å®¡æ ¸æœºåˆ¶(criticaläº‹ä»¶)
- äº‹ä»¶æ¥æºå¯è¿½æº¯
- å½±å“åˆ†æå‡†ç¡®æ€§å›æµ‹(å¯¹æ¯”å®é™…ä»·æ ¼å˜åŒ–)

---

## 9. ç›‘æ§ä¸è¿ç»´

### 9.1 ç›‘æ§æŒ‡æ ‡
- äº‹ä»¶æ”¶é›†æˆåŠŸç‡
- äº‹ä»¶å»é‡ç‡
- AIåˆ†æå»¶è¿Ÿ
- å½±å“åˆ†æå‡†ç¡®ç‡(MAE/RMSE)

### 9.2 å‘Šè­¦è§„åˆ™
- criticaläº‹ä»¶æ”¶é›†å¤±è´¥ â†’ ç«‹å³å‘Šè­¦
- AIåˆ†æé˜Ÿåˆ—ç§¯å‹>100 â†’ å‘Šè­¦
- å½±å“åˆ†æå‡†ç¡®ç‡<60% â†’ å‘Šè­¦

---

## 10. é£é™©ä¸æŒ‘æˆ˜

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| MCPäº‹ä»¶æ•°æ®æºä¸ç¨³å®š | äº‹ä»¶æ”¶é›†å¤±è´¥ | å¤šæ•°æ®æºå¤‡ä»½ã€é™çº§ç­–ç•¥ |
| AIåˆ†ææˆæœ¬é«˜ | è¿è¥æˆæœ¬å¢åŠ  | åˆ†çº§å¤„ç†ã€æ‰¹é‡åˆ†æ |
| äº‹ä»¶å½±å“é¢„æµ‹ä¸å‡† | ç”¨æˆ·ä¿¡ä»»åº¦ä¸‹é™ | ç½®ä¿¡åº¦è¯„åˆ†ã€å›æµ‹ä¼˜åŒ– |
| äº‹ä»¶æ•°æ®é‡å¤§ | æ•°æ®åº“æ€§èƒ½ä¸‹é™ | åˆ†åŒºè¡¨ã€å½’æ¡£ç­–ç•¥ |

---

## 11. æœªæ¥æ‰©å±•

### 11.1 äº‹ä»¶è®¢é˜…ä¸æ¨é€
- ç”¨æˆ·è®¢é˜…ç‰¹å®šç±»å‹äº‹ä»¶
- é‡è¦äº‹ä»¶å®æ—¶æ¨é€(WebSocket/SSE)
- æ¯æ—¥äº‹ä»¶æ‘˜è¦é‚®ä»¶

### 11.2 äº‹ä»¶çŸ¥è¯†å›¾è°±
- äº‹ä»¶é—´å…³è”å…³ç³»
- äº‹ä»¶é“¾åˆ†æ(å› æœå…³ç³»)
- äº‹ä»¶ç›¸ä¼¼åº¦æ¨è

### 11.3 è‡ªå®šä¹‰äº‹ä»¶
- ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ äº‹ä»¶
- ç¤¾åŒºäº‹ä»¶åˆ†äº«
- äº‹ä»¶è¯„è®ºä¸è®¨è®º

---

**æ€»ç»“**: é€šè¿‡å¢å¼ºç°æœ‰æ¶æ„,æ·»åŠ äº‹ä»¶ç®¡ç†æ¨¡å—,è®©AIèƒ½å¤Ÿåœ¨åˆ†æè‚¡ç¥¨å’ŒæŒä»“æ—¶å‚è€ƒæ”¿ç­–äº‹ä»¶ã€å…¬å¸äº‹ä»¶ã€å¸‚åœºäº‹ä»¶å’Œè¡Œä¸šäº‹ä»¶,ä»è€Œæä¾›æ›´å…¨é¢ã€æ›´å‡†ç¡®çš„æŠ•èµ„å»ºè®®ã€‚
