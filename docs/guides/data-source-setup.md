# æ•°æ®æºé…ç½®æŒ‡å—

> é…ç½®Tushare/AkShareè·å–çœŸå®è‚¡ç¥¨æ•°æ®

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¶é—´**: 2025-11-20

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®æºæ¦‚è¿°](#æ•°æ®æºæ¦‚è¿°)
2. [Tushareé…ç½®ï¼ˆæ¨èï¼‰](#tushareé…ç½®æ¨è)
3. [AkShareé…ç½®ï¼ˆå…è´¹å¤‡é€‰ï¼‰](#akshareé…ç½®å…è´¹å¤‡é€‰)
4. [éªŒè¯å®‰è£…](#éªŒè¯å®‰è£…)
5. [æ•°æ®æºå¯¹æ¯”](#æ•°æ®æºå¯¹æ¯”)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ•°æ®æºæ¦‚è¿°

ç³»ç»Ÿæ”¯æŒä¸‰çº§æ•°æ®æºé™çº§æœºåˆ¶ï¼š

```
ä¼˜å…ˆçº§1: Tushare (ä¸“ä¸šæ•°æ®æº)
  â†“ ä¸å¯ç”¨æˆ–æœªé…ç½®
ä¼˜å…ˆçº§2: AkShare (å…è´¹æ•°æ®æº)
  â†“ ä¸å¯ç”¨
é™çº§: Mockæ•°æ® + é…ç½®æç¤º
```

### æ”¯æŒçš„æ•°æ®ç±»å‹

| æ•°æ®ç±»å‹ | Tushare | AkShare | Mock |
|---------|---------|---------|------|
| **å®æ—¶è¡Œæƒ…** | âœ… | âœ… | âœ… |
| **åŸºæœ¬é¢æ•°æ®** | âœ… | âœ… | âœ… |
| **æŠ€æœ¯æŒ‡æ ‡** | âœ… | âœ… | âœ… |
| **è‚¡ç¥¨ä¿¡æ¯** | âœ… | âœ… | âœ… |
| **å†å²æ•°æ®** | âœ… | âœ… | âŒ |
| **è´¢åŠ¡æ•°æ®** | âœ… | âœ… | âŒ |

---

## Tushareé…ç½®ï¼ˆæ¨èï¼‰

### 1. æ³¨å†Œå¹¶è·å–Token

**æ­¥éª¤**:

1. è®¿é—® [Tushareå®˜ç½‘](https://tushare.pro/register)
2. æ³¨å†Œè´¦å·ï¼ˆæ”¯æŒé‚®ç®±ã€æ‰‹æœºï¼‰
3. ç™»å½•åè¿›å…¥ [ä¸ªäººä¸­å¿ƒ](https://tushare.pro/user/token)
4. å¤åˆ¶æ‚¨çš„Tokenï¼ˆæ ¼å¼: `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`ï¼‰

**ç§¯åˆ†è¯´æ˜**:
- æ–°ç”¨æˆ·: 100ç§¯åˆ†ï¼ˆå…è´¹ï¼‰
- åŸºç¡€æ•°æ®: 0ç§¯åˆ†å³å¯ä½¿ç”¨
- é«˜çº§æ•°æ®: éœ€è¦æ›´é«˜ç§¯åˆ†ï¼ˆé€šè¿‡ç­¾åˆ°ã€åˆ†äº«ã€ä»˜è´¹è·å–ï¼‰

### 2. å®‰è£…Tushare

```bash
# è¿›å…¥é¡¹ç›®åç«¯ç›®å½•
cd /Users/mac/Documents/ai/stock/backend

# å®‰è£…Tushare
pip install tushare pandas numpy
```

### 3. é…ç½®Token

**æ–¹å¼1: ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

```bash
# ä¸´æ—¶é…ç½®ï¼ˆå½“å‰ç»ˆç«¯ä¼šè¯ï¼‰
export TUSHARE_TOKEN=your_token_here

# æ°¸ä¹…é…ç½®ï¼ˆæ·»åŠ åˆ° ~/.zshrc æˆ– ~/.bash_profileï¼‰
echo 'export TUSHARE_TOKEN=your_token_here' >> ~/.zshrc
source ~/.zshrc
```

**æ–¹å¼2: .envæ–‡ä»¶**

```bash
# ç¼–è¾‘ backend/.env
echo "TUSHARE_TOKEN=your_token_here" >> backend/.env
```

### 4. éªŒè¯é…ç½®

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python scripts/test_tushare_integration.py
```

æˆåŠŸè¾“å‡ºï¼š
```
âœ… Tushare APIåˆå§‹åŒ–æˆåŠŸ
âœ… Tushare API: å·²è¿æ¥
   æ¨èä½¿ç”¨Tushareè·å–ä¸“ä¸šé‡‘èæ•°æ®
```

---

## AkShareé…ç½®ï¼ˆå…è´¹å¤‡é€‰ï¼‰

### 1. å®‰è£…AkShare

```bash
# è¿›å…¥é¡¹ç›®åç«¯ç›®å½•
cd /Users/mac/Documents/ai/stock/backend

# å®‰è£…AkShare
pip install akshare pandas numpy
```

### 2. æ— éœ€é…ç½®

AkShare **å®Œå…¨å…è´¹**ï¼Œæ— éœ€Tokenæˆ–API Keyã€‚

å®‰è£…åè‡ªåŠ¨å¯ç”¨ï¼š

```
âœ… AkShareåˆå§‹åŒ–æˆåŠŸï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
   ä½¿ç”¨å…è´¹çš„AkShareæ•°æ®æº
```

### 3. æ•°æ®æ¥æº

AkShareä»ä»¥ä¸‹å…¬å¼€æ¸ é“è·å–æ•°æ®ï¼š
- ä¸œæ–¹è´¢å¯Œç½‘
- æ–°æµªè´¢ç»
- åŒèŠ±é¡º
- é›ªçƒç½‘

**ä¼˜ç‚¹**:
- âœ… å®Œå…¨å…è´¹
- âœ… æ— éœ€æ³¨å†Œ
- âœ… æ•°æ®ä¸°å¯Œ

**ç¼ºç‚¹**:
- âš ï¸ ä¾èµ–ç½‘ç»œçˆ¬è™«ï¼Œå¯èƒ½ä¸ç¨³å®š
- âš ï¸ éƒ¨åˆ†æ•°æ®å»¶è¿Ÿ
- âš ï¸ æ— å®˜æ–¹æŠ€æœ¯æ”¯æŒ

---

## éªŒè¯å®‰è£…

### å¿«é€Ÿæµ‹è¯•

```bash
cd /Users/mac/Documents/ai/stock

# è¿è¡Œæ•°æ®æºé›†æˆæµ‹è¯•
python scripts/test_tushare_integration.py
```

### æµ‹è¯•è¦†ç›–

æµ‹è¯•è„šæœ¬ä¼šéªŒè¯ï¼š

1. âœ… **è¿æ¥çŠ¶æ€** - æ£€æŸ¥Tushare/AkShareæ˜¯å¦å¯ç”¨
2. âœ… **å®æ—¶è¡Œæƒ…** - è·å–3åªè‚¡ç¥¨çš„å®æ—¶è¡Œæƒ…
3. âœ… **åŸºæœ¬é¢æ•°æ®** - è·å–PEã€PBã€å¸‚å€¼ç­‰
4. âœ… **æŠ€æœ¯æŒ‡æ ‡** - è·å–MA5ã€MA10ã€MA20ã€MA60
5. âœ… **è‚¡ç¥¨ä¿¡æ¯** - è·å–åç§°ã€è¡Œä¸šã€æ¿å—
6. âœ… **ç»¼åˆæ•°æ®** - æ¨¡æ‹ŸAIåˆ†æåœºæ™¯

### é¢„æœŸè¾“å‡º

**æˆåŠŸï¼ˆTushareï¼‰**:
```
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ•°æ®æºé›†æˆæˆåŠŸ

âœ… AIåˆ†æå¯ä»¥ä½¿ç”¨çœŸå®è‚¡ç¥¨æ•°æ®

ä¸‹ä¸€æ­¥:
1. å¯åŠ¨åç«¯: ./scripts/dev.sh
2. æµ‹è¯•AIåˆ†æ: python scripts/test_ai_features.py
```

**æˆåŠŸï¼ˆAkShareï¼‰**:
```
æ€»è®¡: 4/6 é€šè¿‡

âš ï¸  æœ‰ 2 é¡¹æµ‹è¯•å¤±è´¥ï¼ˆå®æ—¶è¡Œæƒ…å¯èƒ½ä¸ç¨³å®šï¼‰
ä½†åŸºæœ¬åŠŸèƒ½å¯ç”¨
```

---

## æ•°æ®æºå¯¹æ¯”

### Tushare vs AkShare

| é¡¹ç›® | Tushare | AkShare |
|------|---------|---------|
| **æˆæœ¬** | å…è´¹ï¼ˆåŸºç¡€ï¼‰+ ä»˜è´¹ï¼ˆé«˜çº§ï¼‰ | å®Œå…¨å…è´¹ |
| **æ³¨å†Œ** | éœ€è¦ | ä¸éœ€è¦ |
| **æ•°æ®è´¨é‡** | â­â­â­â­â­ ä¸“ä¸š | â­â­â­â­ è‰¯å¥½ |
| **æ•°æ®ç¨³å®šæ€§** | â­â­â­â­â­ éå¸¸ç¨³å®š | â­â­â­ ä¸€èˆ¬ |
| **æ›´æ–°é€Ÿåº¦** | åˆ†é’Ÿçº§ | åˆ†é’Ÿçº§ |
| **APIé™åˆ¶** | æœ‰ï¼ˆä½†åŸºç¡€æ•°æ®å¤Ÿç”¨ï¼‰ | æ—  |
| **æŠ€æœ¯æ”¯æŒ** | å®˜æ–¹ç¤¾åŒº | ç¤¾åŒº |
| **æ¨èåœºæ™¯** | ç”Ÿäº§ç¯å¢ƒ | å¼€å‘æµ‹è¯• |

### æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | Tushare | AkShare | Mock |
|------|---------|---------|------|
| **è·å–è¡Œæƒ…** | ~0.5ç§’ | ~1-2ç§’ | å³æ—¶ |
| **è·å–åŸºæœ¬é¢** | ~0.5ç§’ | ~1-2ç§’ | å³æ—¶ |
| **è·å–æŠ€æœ¯æŒ‡æ ‡** | ~1ç§’ | ~2-3ç§’ | å³æ—¶ |
| **å¯é æ€§** | 99%+ | 90%+ | 100% |

---

## ä½¿ç”¨ç¤ºä¾‹

### åœ¨AIåˆ†æä¸­ä½¿ç”¨

æ•°æ®æºå·²ç»é›†æˆåˆ°AIåˆ†ææœåŠ¡ä¸­ï¼Œæ— éœ€é¢å¤–ä»£ç ï¼š

```python
# backend/app/services/ai/single_analysis_service.py

# 1. è‡ªåŠ¨è·å–çœŸå®è‚¡ç¥¨æ•°æ®
stock_data = await SingleAnalysisConverter.fetch_stock_data(
    symbol="600519",
    include_fundamentals=True,
    include_technicals=True
)

# 2. æ•°æ®ä¼ å…¥AI Prompt
analysis_result = await SingleAnalysisConverter.analyze_with_ai(
    symbol="600519",
    stock_name="è´µå·èŒ…å°",
    stock_data=stock_data,  # âœ… çœŸå®æ•°æ®
    ...
)
```

### Promptä¸­çš„æ•°æ®æ ¼å¼

AIä¼šæ”¶åˆ°å¦‚ä¸‹æ ¼å¼çš„çœŸå®æ•°æ®ï¼š

```
**å½“å‰è‚¡ç¥¨æ•°æ®**:

**å®æ—¶è¡Œæƒ…**:
- æœ€æ–°ä»·: 1650.50 å…ƒ
- æ¶¨è·Œå¹…: 1.26%
- æ¶¨è·Œé¢: 20.50 å…ƒ
- ä»Šå¼€: 1645.00 å…ƒ
- æœ€é«˜: 1658.00 å…ƒ
- æœ€ä½: 1642.00 å…ƒ
- æ˜¨æ”¶: 1630.00 å…ƒ
- æˆäº¤é‡: 15000000 è‚¡
- æˆäº¤é¢: 247.50 äº¿å…ƒ
- æ•°æ®æ¥æº: tushare

**åŸºæœ¬é¢æŒ‡æ ‡**:
- å¸‚ç›ˆç‡(PE): 35.2
- å¸‚å‡€ç‡(PB): 8.5
- å¸‚é”€ç‡(PS): 12.3
- æ€»å¸‚å€¼: 2075.00 äº¿å…ƒ
- æµé€šå¸‚å€¼: 2075.00 äº¿å…ƒ

**æŠ€æœ¯æŒ‡æ ‡**:
- MA5: 1640.50 å…ƒ
- MA10: 1635.20 å…ƒ
- MA20: 1620.80 å…ƒ
- MA60: 1595.30 å…ƒ

**è‚¡ç¥¨ä¿¡æ¯**:
- è‚¡ç¥¨åç§°: è´µå·èŒ…å°
- æ‰€å±è¡Œä¸š: ç™½é…’
- ä¸Šå¸‚æ¿å—: ä¸»æ¿
```

---

## å¸¸è§é—®é¢˜

### Q1: Tushare Tokenæ— æ•ˆï¼Ÿ

**ç—‡çŠ¶**:
```
âš ï¸  Tushareåˆå§‹åŒ–å¤±è´¥: HTTP Error 401: Unauthorized
```

**è§£å†³**:
1. æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®å¤åˆ¶ï¼ˆæ— ç©ºæ ¼ã€æ— æ¢è¡Œï¼‰
2. ç¡®è®¤Tokenåœ¨Tushareå®˜ç½‘ä¸ªäººä¸­å¿ƒå¯è§
3. é‡æ–°è®¾ç½®ç¯å¢ƒå˜é‡å¹¶é‡å¯ç»ˆç«¯

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $TUSHARE_TOKEN

# é‡æ–°è®¾ç½®
export TUSHARE_TOKEN=your_correct_token
```

---

### Q2: AkShareè·å–æ•°æ®å¤±è´¥ï¼Ÿ

**ç—‡çŠ¶**:
```
AkShareè·å–è¡Œæƒ…å¤±è´¥: Connection aborted
```

**åŸå› **:
- ç½‘ç»œè¿æ¥é—®é¢˜
- ç›®æ ‡ç½‘ç«™ä¸´æ—¶ä¸å¯ç”¨
- æ•°æ®æºç½‘ç«™æ›´æ–°å¯¼è‡´APIå˜åŒ–

**è§£å†³**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¨åé‡è¯•
3. å‡çº§AkShare: `pip install --upgrade akshare`
4. å¦‚æœæŒç»­å¤±è´¥ï¼Œé…ç½®Tushare

---

### Q3: ä¸¤è€…éƒ½ä¸å¯ç”¨æ€ä¹ˆåŠï¼Ÿ

**ç—‡çŠ¶**:
```
âš ï¸  æ•°æ®æºæœªé…ç½®ï¼Œå°†ä½¿ç”¨Mockæ•°æ®
```

**å½±å“**:
- AIä»ç„¶å¯ä»¥è¿è¡Œ
- ä½†åˆ†æåŸºäºMockæ•°æ®ï¼Œä¸å‡†ç¡®
- å»ºè®®ä»…ç”¨äºå¼€å‘æµ‹è¯•

**è§£å†³**:
1. ä¼˜å…ˆé…ç½®Tushareï¼ˆæ›´ç¨³å®šï¼‰
2. æˆ–å®‰è£…AkShareï¼ˆæ›´ç®€å•ï¼‰

---

### Q4: æ•°æ®è·å–å¾ˆæ…¢ï¼Ÿ

**Tushare**:
- æ­£å¸¸å“åº”: 0.5-1ç§’
- å¦‚æœæ…¢: æ£€æŸ¥ç½‘ç»œï¼Œæˆ–TushareæœåŠ¡å™¨è´Ÿè½½é«˜

**AkShare**:
- æ­£å¸¸å“åº”: 1-3ç§’
- å¦‚æœæ…¢: ç½‘ç»œçˆ¬è™«å¯èƒ½è¢«é™é€Ÿï¼Œç­‰å¾…æˆ–æ¢Tushare

**ä¼˜åŒ–å»ºè®®**:
```python
# å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆTODOï¼‰
# å‡å°‘é‡å¤è¯·æ±‚
# æ‰¹é‡è·å–æ•°æ®æ—¶å¢åŠ å»¶è¿Ÿ
```

---

### Q5: å¦‚ä½•åˆ‡æ¢æ•°æ®æºï¼Ÿ

**è‡ªåŠ¨åˆ‡æ¢**:

ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§é€‰æ‹©ï¼š

```python
if tushare_token:
    use_tushare()  # ä¼˜å…ˆ
elif akshare_installed:
    use_akshare()  # å¤‡é€‰
else:
    use_mock()     # é™çº§
```

**æ‰‹åŠ¨å¼ºåˆ¶**:

æš‚ä¸æ”¯æŒï¼Œç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹æ¡ˆã€‚

---

### Q6: ç”Ÿäº§ç¯å¢ƒæ¨èå“ªä¸ªï¼Ÿ

**æ¨è: Tushare**

åŸå› :
- âœ… æ•°æ®è´¨é‡é«˜
- âœ… ç¨³å®šæ€§å¥½
- âœ… å®˜æ–¹æ”¯æŒ
- âœ… é€‚åˆç”Ÿäº§ç¯å¢ƒ

**æˆæœ¬**:
- åŸºç¡€æ•°æ®: å…è´¹ï¼ˆå¤Ÿç”¨ï¼‰
- é«˜çº§æ•°æ®: éœ€è¦ç§¯åˆ†ï¼ˆå¯é€šè¿‡ç­¾åˆ°ã€åˆ†äº«è·å–ï¼‰
- ä¸“ä¸šç‰ˆ: Â¥500/å¹´ï¼ˆå¦‚éœ€å®Œæ•´è´¢åŠ¡æ•°æ®ï¼‰

---

## æŠ€æœ¯ç»†èŠ‚

### ä»£ç ä½ç½®

```
backend/app/utils/tushare_client.py  # æ•°æ®æºå®¢æˆ·ç«¯
backend/app/services/ai/single_analysis_service.py  # AIåˆ†ææœåŠ¡
backend/app/utils/ai_client.py  # AI Promptæ„å»ºå™¨
scripts/test_tushare_integration.py  # æµ‹è¯•è„šæœ¬
```

### å…³é”®API

```python
from app.utils.tushare_client import tushare_client

# å®æ—¶è¡Œæƒ…
quote = await tushare_client.get_realtime_quote("600519")

# åŸºæœ¬é¢
fundamentals = await tushare_client.get_fundamentals("600519")

# æŠ€æœ¯æŒ‡æ ‡
technicals = await tushare_client.get_technical_indicators("600519")

# è‚¡ç¥¨ä¿¡æ¯
info = await tushare_client.get_stock_info("600519")
```

### é™çº§é€»è¾‘

```python
class TushareClient:
    def __init__(self):
        # 1. å°è¯•Tushare
        if self.tushare_token:
            self.use_tushare = True
        # 2. é™çº§AkShare
        elif akshare_installed:
            self.use_akshare = True
        # 3. é™çº§Mock
        else:
            print("ä½¿ç”¨Mockæ•°æ®")
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç¼“å­˜æœºåˆ¶ï¼ˆTODOï¼‰

```python
# è®¡åˆ’å®ç°Redisç¼“å­˜
# ç›¸åŒè‚¡ç¥¨15åˆ†é’Ÿå†…å¤ç”¨æ•°æ®
# å‡å°‘APIè°ƒç”¨æ¬¡æ•°
```

### 2. æ‰¹é‡è·å–

```python
# æ‰¹é‡åˆ†ææ—¶ï¼Œæ·»åŠ å»¶è¿Ÿé¿å…é™æµ
for symbol in symbols:
    data = await get_stock_data(symbol)
    await asyncio.sleep(0.5)  # é¿å…è¯·æ±‚è¿‡å¿«
```

### 3. å¼‚æ­¥å¹¶å‘

```python
# åŒæ—¶è·å–å¤šä¸ªæ•°æ®æº
tasks = [
    get_realtime_quote(symbol),
    get_fundamentals(symbol),
    get_technicals(symbol)
]
results = await asyncio.gather(*tasks)
```

---

## æ•°æ®æºè·¯çº¿å›¾

### Phase 1: åŸºç¡€é›†æˆ âœ… å·²å®Œæˆ

- [x] Tushareå®¢æˆ·ç«¯
- [x] AkShareå®¢æˆ·ç«¯
- [x] è‡ªåŠ¨é™çº§
- [x] æ•°æ®ä¼ å…¥AI

### Phase 2: æ€§èƒ½ä¼˜åŒ–ï¼ˆè¿›è¡Œä¸­ï¼‰

- [ ] Redisç¼“å­˜
- [ ] æ‰¹é‡è·å–ä¼˜åŒ–
- [ ] å¼‚æ­¥å¹¶å‘

### Phase 3: æ•°æ®æ‰©å±•ï¼ˆè®¡åˆ’ä¸­ï¼‰

- [ ] å†å²Kçº¿æ•°æ®
- [ ] è´¢åŠ¡æŠ¥è¡¨æ•°æ®
- [ ] è¡Œä¸šæ•°æ®
- [ ] å®è§‚æ•°æ®

---

## ç›¸å…³æ–‡æ¡£

- [AIåŠŸèƒ½è®¾ç½®](ai-setup.md)
- [AIåŠŸèƒ½æµ‹è¯•](ai-testing-guide.md)
- [Tushareå®˜æ–¹æ–‡æ¡£](https://tushare.pro/document/2)
- [AkShareå®˜æ–¹æ–‡æ¡£](https://akshare.akfamily.xyz/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-20
**ç»´æŠ¤è€…**: AI Development Team
