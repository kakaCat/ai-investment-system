# PRD v3.2 — AI驱动的个人投资管理与复盘系统

**版本**: v3.2
**状态**: 基于HTML原型更新
**日期**: 2025-01-14
**范围**: 多账户投资管理、AI策略生成、策略复盘、资金流动性管理、事件分析与追踪、UI/UX设计

**v3.2 更新**:
- ✨ 新增完整的UI/UX设计规范（基于HTML原型）
- ✨ 明确"服务于买卖股票决策"的产品理念
- ✨ 详细的5个核心页面设计说明
- ✨ 新增个股操作策略管理功能
- ✨ 新增快速操作入口和模态框交互
- ✨ 优化信息架构：AI策略建议置顶、账户总览折叠
- ✨ 持仓与关注股票合并展示
- ✨ 完整的交互规范和状态管理

---

## 1. 背景与目标

### 1.1 产品理念

**核心理念：服务于买卖股票决策**

用户使用投资管理系统的主要目的是**做出更好的买卖决策**，而非查看财务报表。因此，系统设计遵循以下原则：

1. **决策优先**：
   - AI策略建议永远在最显眼位置
   - 每只股票都有明确的操作建议（买入/卖出/观望）
   - 操作建议包含具体价格区间和数量

2. **个股聚焦**：
   - 用户关心的是"每只股票怎么操作"
   - 持仓列表按操作优先级排序
   - 关注股票展示潜在买入机会

3. **整体信息弱化**：
   - 总资产、总盈亏等整体信息折叠显示
   - 用户不需要天天看整体状态
   - 整体分析（一周/一月/一年一次）放在次要位置

4. **行动导向**：
   - 按钮文案："买入"、"卖出"、"记录交易"
   - 避免模糊表达："查看"、"详情"
   - 每个界面都有明确的行动指引

### 1.2 目标

1. **精准决策辅助**：基于AI分析，给出可执行的买卖建议
2. **操作效率**：快速记录交易、添加关注、执行策略
3. **策略可追溯**：完整记录AI建议和执行情况
4. **复盘学习**：分析策略执行效果，持续改进

---

## 2. 核心功能需求

### 2.1 用户与认证

#### 2.1.1 用户注册与登录
- 邮箱注册
- 用户名/邮箱 + 密码登录
- JWT Token认证

#### 2.1.2 AI Token管理
- **Token套餐**：用户购买AI调用额度
  - 基础套餐：10万tokens（约100次分析）
  - 标准套餐：50万tokens（约500次分析）
  - 高级套餐：200万tokens（约2000次分析）
- **Token消耗追踪**：
  - 每次AI调用记录消耗量
  - 实时显示剩余额度
  - 余额不足时提醒充值
- **消耗明细**：
  - 分析类型、消耗量、时间
  - 按日/周/月统计

---

### 2.2 账户管理

#### 2.2.1 账户基本信息
每个账户包含：
- **账户名称**：华泰证券、中信证券等
- **券商名称**：券商标识
- **账号后四位**：用于区分
- **总资金**：该账户投入的总资金（如30万）
- **已投资金额**：当前持仓市值
- **流动资金**：可用于新建仓或加仓的资金
- **冻结资金**：待交割资金（可选）
- **账户状态**：活跃、归档

#### 2.2.2 账户操作
- **添加账户**：首页/账户详情页一键添加
- **编辑账户**：修改账户信息
- **归档账户**：不再使用的账户归档（不删除）
- **切换账户**：首页顶部账户选择器

---

### 2.3 股票信息库

#### 2.3.1 股票基础信息
- **股票代码**：600600、00700、AAPL等
- **股票名称**：青岛啤酒、腾讯控股等
- **市场**：A股、港股、美股、其他
- **所属行业**：消费、科技、金融等
- **图标/Logo**：用于UI展示（Emoji或图片）

#### 2.3.2 股票数据源
- **实时行情**：通过MCP获取最新价格
- **历史数据**：K线数据、财报数据
- **事件数据**：公司公告、新闻、政策

---

### 2.4 持仓管理

#### 2.4.1 持仓信息
每笔持仓包含：
- **股票**：关联stock_id
- **账户**：关联account_id
- **持仓数量**：当前持有股数
- **成本价**：平均成本（自动计算）
- **当前价格**：实时更新
- **市值**：持仓数量 × 当前价格
- **盈亏金额**：市值 - 成本
- **盈亏比例**：(市值 - 成本) / 成本
- **占比**：该持仓占账户已投资金额的比例

#### 2.4.2 持仓操作
- **查看持仓详情**：跳转到股票详情页
- **个股操作策略**：查看该股票的买卖计划
- **记录交易**：快速买入/卖出
- **AI分析**：单股分析或全部持仓分析

---

### 2.5 关注列表（自选股）

#### 2.5.1 关注股票信息
- **股票**：关联stock_id
- **用户**：关联user_id
- **关注度**：1-5星，表示研究优先级
  - ⭐⭐⭐⭐⭐ 极高关注（即将买入）
  - ⭐⭐⭐⭐ 高关注
  - ⭐⭐⭐ 中关注
  - ⭐⭐ 低关注
  - ⭐ 待评估
- **备注**：关注理由、目标价位等
- **添加时间**：记录关注时间

#### 2.5.2 关注股票操作
- **添加关注**：首页/持仓页一键添加
- **调整关注度**：修改星级
- **买入建议**：AI生成的买入价格区间和数量
- **移除关注**：买入后或不再关注

#### 2.5.3 关注列表展示
- **与持仓合并**：持仓和关注在同一列表
  - 持仓：蓝色背景，显示持仓数量
  - 关注：橙色背景，显示星级关注度
- **排序**：持仓在前，关注在后
- **操作建议**：每只股票都有AI生成的建议

---

### 2.6 交易记录

#### 2.6.1 交易信息
每笔交易包含：
- **类型**：买入、卖出
- **股票**：关联stock_id
- **账户**：关联account_id
- **数量**：交易股数
- **价格**：成交价格
- **金额**：数量 × 价格
- **手续费**：佣金 + 印花税 + 过户费等
- **交易时间**：精确到秒
- **备注**：交易原因、市场情况等

#### 2.6.2 交易记录功能
- **快速记录**：首页/持仓页快速入口
- **筛选查询**：按类型、时间、股票筛选
- **导出Excel**：支持导出交易明细
- **关联策略**：标记是否按策略执行

---

### 2.7 个股操作策略

**新增功能**：为每只股票管理买卖计划

#### 2.7.1 策略信息
每条策略包含：
- **股票**：关联stock_id
- **用户**：关联user_id
- **类型**：买入、卖出
- **触发条件**：价格区间（如¥58-60）
- **操作数量**：建议买入/卖出股数
- **策略理由**：AI分析或用户自定义
- **优先级**：高、中、低
- **状态**：待执行、已执行、已取消
- **创建时间**：策略生成时间
- **执行时间**：实际执行时间（如有）

#### 2.7.2 策略展示
- **持仓列表**：点击"个股操作"按钮打开模态框
- **股票详情页**：显示策略列表
- **模态框内容**：
  - 股票名称和代码
  - 策略列表（按优先级排序）
  - 每条策略显示：类型标签、触发价格、数量、理由、状态

#### 2.7.3 策略管理
- **AI生成**：基于持仓分析自动生成
- **手动添加**：用户自定义买卖计划
- **执行标记**：记录交易后自动标记为已执行
- **复盘分析**：统计策略执行率和效果

---

### 2.8 AI策略生成

#### 2.8.1 单股分析
**输入**：
- 股票基本信息
- 持仓情况（如有）
- 近期价格走势
- 相关事件

**输出**：
- 当前评估（看多/看空/中性）
- 具体操作建议：
  - 如果持仓：持有/加仓/减仓/止损
  - 如果关注：买入/观望/移除
- 价格区间建议
- 风险提示
- Token消耗记录

#### 2.8.2 持仓分析
**输入**：
- 所有持仓股票
- 账户流动资金
- 行业分布
- 相关事件

**输出**：
- 持仓结构评估
- 风险提示（集中度、行业风险）
- 个股操作建议（优先级排序）
- 加仓/减仓/轮动建议
- Token消耗记录

#### 2.8.3 今日策略建议
**首页AI策略建议区域**：
- 3个核心建议卡片
- 每个建议包含：
  - 操作类型（买入/卖出/风控）
  - 股票名称
  - 具体行动（价格区间+数量）
  - 理由说明
  - 优先级标识
- 实时更新标签
- 链接到完整AI分析

---

### 2.9 事件分析与追踪

#### 2.9.1 事件分类体系

**四大类事件**：

1. **政策事件（Policy）**
   - 货币政策：央行降息/加息、MLF操作、存准率调整
   - 财政政策：减税降费、补贴政策、地方债发行
   - 监管政策：IPO新规、退市规则、交易规则变更
   - 行业政策：新能源政策、医药改革、房地产调控

2. **公司事件（Company）**
   - 财报发布：季报、半年报、年报
   - 分红送转：分红方案、送股、配股
   - 公司公告：重大重组、收购兼并、高管变动
   - 业绩预告：业绩预增、业绩下滑

3. **市场事件（Market）**
   - 指数调整：沪深300、恒生指数权重调整
   - 融资融券：标的股票变更、融资余额变化
   - 北向资金：陆股通/港股通大额流入流出
   - 解禁减持：大股东减持、限售股解禁

4. **行业事件（Industry）**
   - 技术突破：新技术发布、专利申请
   - 竞争格局：行业整合、市场份额变化
   - 供需变化：原材料价格、产能过剩/短缺
   - 黑天鹅：突发危机、安全事故

#### 2.9.2 事件影响分析

**AI事件分析流程**：
1. **事件识别**：从新闻、公告中提取结构化事件
2. **影响范围**：识别受影响的股票、行业
3. **影响程度**：评估正面/负面影响和强度
4. **操作建议**：生成具体的买卖建议
5. **Token消耗**：记录AI调用成本

**影响等级**：
- **Critical**（红色）：重大影响，需立即行动
- **High**（橙色）：重要影响，需关注
- **Medium**（黄色）：一般影响，可观望
- **Low**（绿色）：轻微影响，无需操作

#### 2.9.3 事件与持仓集成

- **事件提醒**：
  - 首页显示影响持仓的重要事件
  - Critical/High事件推送通知
  - 每条事件显示影响的股票和预期影响

- **股票详情页**：
  - 事件时间线：按时间倒序展示相关事件
  - 每个事件显示：时间、类型、标题、影响评估
  - 点击查看详细分析

- **事件中心**：
  - 全部事件列表
  - 筛选：按类型、影响等级、日期
  - 批量AI分析：选中多个事件进行综合分析
  - 日历视图：按日期查看事件

---

### 2.10 策略复盘

#### 2.10.1 复盘数据
- **时间范围**：最近一周/一月/三月/一年/自定义
- **交易统计**：
  - 交易次数
  - 成功率（盈利交易/总交易）
  - 平均持仓天数
  - 总收益率
- **策略执行情况**：
  - 成功执行：策略与实际匹配
  - 错失机会：策略未执行导致损失
  - 失败执行：执行了错误策略
- **AI复盘建议**：
  - 分析成功和失败的原因
  - 纪律性评估
  - 改进建议

#### 2.10.2 复盘入口
- **首页快速操作**："策略复盘"按钮
- **模态框展示**：
  - 时间选择器
  - 关键指标卡片
  - 策略执行情况列表
  - AI建议区域

---

### 2.11 快速操作

**首页快速操作区域**（5个核心入口）：

1. **🔍 添加自选**
   - 打开模态框
   - 输入股票代码/名称搜索
   - 选择关注度（星级）
   - 填写备注

2. **📈 记录交易**
   - 打开模态框
   - 选择股票（持仓列表）
   - 选择类型（买入/卖出）
   - 填写数量、价格、时间、手续费
   - 自动更新持仓和资金

3. **💡 AI策略**
   - 跳转到持仓分析页
   - 查看完整AI分析报告

4. **📅 事件日历**
   - 跳转到事件中心
   - 日历视图查看事件

5. **📊 策略复盘**
   - 打开模态框
   - 选择复盘周期
   - 查看复盘报告

---

## 3. UI/UX设计

### 3.1 设计原则

1. **决策驱动**：信息呈现以支持决策为主
2. **视觉层级**：重要信息（AI建议）大而醒目
3. **行动导向**：按钮语义明确，避免模糊
4. **色彩编码**：
   - 红色：卖出、减仓、Critical事件
   - 绿色：买入、加仓
   - 蓝色：持仓信息
   - 橙色：关注股票、High事件
   - 黄色：观望、Medium事件
   - 灰色：已完成、Low事件

5. **响应式**：支持桌面、平板、手机

---

### 3.2 页面设计

#### 3.2.1 首页（Dashboard）

**页面结构**（从上到下）：

1. **顶部导航栏**
   - Logo：投资管理系统
   - 账户选择器
   - 添加账户按钮
   - 搜索框
   - AI分析按钮
   - 通知图标
   - 用户头像

2. **AI策略建议（置顶，最大面积）**
   - 深蓝色渐变背景 + 加粗边框
   - 标题：🤖 今日AI策略建议
   - 副标题：基于您的持仓和流动资金分析
   - "实时更新"徽章
   - 3个建议卡片（3列网格）：
     - 每个卡片：白色背景、悬停阴影
     - 图标：✅ ⏳ 💰
     - 标题：减仓腾讯控股 20股
     - 描述：降低港股敞口，规避美联储加息风险
     - 操作类型标签：卖出/买入/风控
     - 优先级文字：优先级: 高
   - 2个按钮：
     - "查看完整AI分析"（白色按钮，链接到持仓分析页）
     - "📊 策略复盘"（半透明按钮，打开模态框）

3. **账户总览（折叠，默认隐藏）**
   - 折叠按钮：
     - 左侧：标题"账户总览" + 总资产¥850,000 + 盈亏+¥19,100 (+2.3%)
     - 右侧：下箭头图标（点击旋转）
   - 展开内容：
     - 4个指标卡片：总资金、已投资、流动资金、今日盈亏
     - 2个账户卡片（华泰证券、中信证券）：显示流动资金比例

4. **我的持仓（3只）- 卡片样式**
   - 标题：📊 我的持仓（3只）
   - 副标题：按今日操作优先级排序
   - 右侧按钮："+ 记录交易"、"完整持仓"

   **持仓卡片设计**（每只股票独立卡片）：

   - **腾讯控股（优先级最高）**：
     - 边框：红色（border-red-200）
     - 背景：浅红色（bg-red-50）
     - 顶部：
       - 左：图标📱 + 股票名称 + 代码
       - 标签：🔻 建议减仓（红色）、⚠️ 重要事件（橙色）、优先级: 高
       - 右：盈亏金额（大字体）
     - 持仓信息卡片：
       - 4列网格：持仓/成本价/现价/市值
     - 今日操作建议框（红色背景）：
       - 标题：📍 今日操作建议
       - 建议列表（带颜色圆点）
     - 按钮：
       - "记录卖出"（红色按钮）
       - "查看详情"（红色边框按钮）

   - **青岛啤酒（等待加仓）**：
     - 边框/背景：黄色
     - 标签：💎 加仓机会、⚠️ 有事件、优先级: 中
     - 建议框：黄色背景
     - 按钮："记录买入"（绿色）

   - **比亚迪（持有观望）**：
     - 边框/背景：灰色
     - 标签：✓ 持有观望、优先级: 低
     - 建议框：灰色背景
     - 按钮："查看详情"（灰色边框）

5. **关注股票（4只）- 网格布局**
   - 标题：⭐ 关注股票（4只）
   - 副标题：研究中的潜在投资机会
   - 右侧按钮："+ 添加关注"
   - 2列网格（桌面）/ 1列（移动）

   **关注卡片设计**：
   - **恒瑞医药（5星）**：
     - 边框/背景：绿色（即将买入）
     - 星级：★★★★★ + 极高关注
     - 买入建议框：¥43-45 分批建仓200-300股
     - 按钮："买入"（绿色）+ "研究"（绿色边框）

   - **招商银行（4星）**：
     - 边框/背景：蓝色
     - 星级：★★★★☆ + 高关注
     - 买入建议框
     - 按钮："买入" + "研究"

   - **贵州茅台（3星）**：
     - 边框/背景：灰色
     - 星级：★★★☆☆ + 中关注
     - 建议：考虑小仓位
     - 按钮："继续观察"

   - **宁德时代（2星）**：
     - 边框/背景：灰色
     - 星级：★★☆☆☆ + 低关注
     - 建议：暂不建议
     - 按钮："继续观察"

6. **快速操作**
   - 5列网格布局
   - 每个按钮：
     - 大图标（Emoji）
     - 标题文字
     - 边框悬停效果

**首页交互**：
- 折叠账户总览：点击箭头展开/收起
- 个股操作策略：点击持仓卡片"查看详情"跳转到股票详情页
- 快速记录交易：点击"记录买入/卖出"打开模态框
- 策略复盘：点击打开模态框

---

#### 3.2.2 账户详情页

**页面结构**：

1. **顶部导航**：同首页

2. **账户信息卡片**
   - 左侧：账户名称、券商、账号
   - 右侧：总资金、流动资金、收益率
   - 编辑按钮

3. **AI账户分析（折叠面板）**
   - 折叠按钮：
     - 左：🤖 AI账户分析 + 说明
     - 右：综合评分B+ + 下箭头
   - 展开内容：
     - 持仓结构分析
     - 风险提示
     - 调仓建议

4. **持股列表和关注股票（合并表格）**
   - 标题：持股列表
   - 右侧按钮："+ 添加股票"、"📝 记录交易"、"导出持仓"
   - 表格列：
     - 类型（持仓-蓝色标签 / 关注-橙色标签）
     - 股票
     - 持仓/关注度（持仓显示股数 / 关注显示星级）
     - 成本价
     - 现价
     - 市值/涨跌幅
     - 盈亏
     - 占比
     - 今日操作建议
     - 操作（"个股操作"按钮）

   **今日操作建议**：
   - 状态标签：✋ 暂时观望 / 🔻 建议减仓 / ✓ 持有待涨
   - 价格区间建议（2-3条）：
     - ¥58-60 加仓300-400股（绿色）
     - ¥70-72 减仓400-500股（红色）
   - 当前价分析文字

5. **其他功能Tab**
   - Tab导航：📈 资金曲线、📝 交易记录、📊 绩效分析、💰 资金流水

   **资金曲线Tab**：
   - 时间范围按钮：近1月、近3月、近6月、今年、全部
   - 图表占位符（集成ECharts）
   - 关键指标：本月收益、交易次数、换手率
   - 资金分布：买入、持仓、流动

   **交易记录Tab**：
   - 筛选器：类型（全部/买入/卖出）、时间（30天/3月/1年）
   - 导出Excel按钮
   - 交易表格：日期时间、股票、操作、数量、价格、金额、手续费、备注

   **绩效分析Tab**：
   - 关键指标卡片：累计收益率、年化收益率、最大回撤、胜率
   - 持仓绩效表：每只股票的收益率、持仓天数、交易次数

   **资金流水Tab**：
   - 资金变动卡片列表
   - 每条记录：时间、类型（买入/卖出/转账）、股票、金额、流水说明

**交互**：
- 个股操作按钮：打开模态框，显示该股票的买卖策略列表
- Tab切换：`switchTab2()` 函数
- 资金曲线时间选择：`selectTimeRange()` 函数
- 添加股票/记录交易：打开对应模态框

---

#### 3.2.3 股票详情页

**页面结构**：

1. **股票头部**
   - 左侧：图标 + 股票名称 + 代码
   - 右侧：
     - 当前价（大字体）
     - 涨跌幅（颜色标识）
     - 日期时间

2. **Tab导航**
   - 事件时间线
   - 我的持仓
   - K线图
   - AI分析

3. **事件时间线Tab（默认）**
   - 筛选按钮：全部、政策、公司、市场、行业
   - 事件卡片列表：
     - 时间
     - 类型标签（颜色编码）
     - 事件标题
     - 影响评估
     - AI分析摘要
     - "查看详情"按钮
   - "显示更多事件"链接（跳转到事件中心）

4. **我的持仓Tab**
   - **个股操作策略列表**（新增）：
     - 标题：📋 个股操作策略
     - 副标题：买入卖出计划和执行记录
     - 统计：待执行 5、已完成 1
     - 策略卡片：
       - 卖出策略（红色边框）：触发价位、操作数量、理由、状态
       - 买入策略（绿色边框）
       - 已完成策略（灰色边框，半透明）
     - 提示：黄色警告框

   - **交易历史**：
     - 交易记录表格

   - **持仓统计**：
     - 成本、市值、盈亏等

5. **K线图Tab**：图表占位符

6. **AI分析Tab**：
   - AI分析结果
   - 操作建议
   - 风险提示

---

#### 3.2.4 事件中心

**页面结构**：

1. **顶部搜索与操作栏**
   - 搜索框：全文搜索事件
   - "AI批量分析"按钮
   - 设置按钮（配置通知、订阅等）

2. **事件统计概览**
   - 总事件数卡片
   - 未读事件数卡片（红点标识）
   - 重要事件数卡片（Critical + High）
   - 今日新增事件数卡片
   - 交互：点击卡片快速应用对应筛选

3. **筛选器**
   - **时间范围**：今天 / 近7天 / 近30天 / 近90天 / 自定义
   - **事件类型**：全部 / 政策 / 公司 / 市场 / 行业
   - **重要性**：全部 / Critical / High / Medium / Low
   - **影响范围**：全部 / 全球 / 特定市场 / 特定行业 / 特定股票
   - **市场**：全部 / A股 / 港股 / 美股
   - **我的持仓**：复选框，仅显示影响持仓的事件
   - "重置筛选"按钮
   - 实时显示筛选结果数量

4. **视图切换**
   - **列表视图**（默认）：按时间倒序列表
   - **时间轴视图**：垂直时间轴展示
   - **日历视图**：日历格式，点击日期查看当天事件

5. **事件时间线（列表视图）**
   - 按日期分组显示
   - 排序选项：时间倒序 / 时间正序 / 重要性排序 / 影响力排序
   - 事件卡片内容：
     - **基本信息**：
       - 时间（精确到分钟）
       - 重要性级别（图标+颜色）
       - 事件分类（类型 > 子类型）
       - 事件标题/摘要
     - **影响分析**：
       - 影响方向（利好/利空/中性）
       - 影响强度评分（0-100）
       - 影响范围（全球市场/特定股票/行业）
       - 市场/股价实际反应数据
     - **持仓关联**（如影响用户持仓）：
       - 受影响的持仓股票列表
       - 对每只持仓股票的预期影响
       - AI操作建议
     - **操作按钮**：
       - 查看完整分析
       - 标记已读/未读
       - 添加到策略
       - 查看股票详情（跳转）
       - 分享
     - **卡片配色**：
       - 🔴 红色边框：Critical
       - 🟠 橙色边框：High
       - 🟡 黄色边框：Medium
       - 🟢 绿色边框：Low

6. **时间轴视图**
   - 垂直时间轴，按日期排列
   - 紧凑卡片展示（标题+影响+快捷操作）
   - 点击展开查看详情

7. **日历视图**
   - 月历显示
   - 有事件的日期用圆点标识
   - 事件密度用颜色深浅表示
   - 点击日期查看当天事件列表
   - "今天"按钮快速跳转
   - "跳转到日期"功能

8. **批量操作面板**
   - 选择机制：
     - 事件卡片左上角复选框
     - "全选当前页"按钮
     - 已选中数量实时显示
   - 批量操作：
     - 批量AI分析（综合影响分析）
     - 批量标记已读
     - 导出选中（PDF/Excel）
     - 添加到日历

9. **加载与刷新**
   - 下拉刷新
   - "加载更多"按钮
   - "跳转到日期"功能
   - WebSocket实时推送（Critical事件立即推送）

10. **空状态与错误处理**
    - 无事件："暂无事件，系统将自动采集最新事件"
    - 筛选无结果："未找到符合条件的事件，尝试调整筛选条件"
    - 加载失败：重试按钮

---

#### 3.2.5 持仓分析页

**页面结构**：

1. **综合评分卡片**
   - 大字体评分：B+
   - 评分说明
   - 关键问题数量

2. **持仓结构分析**
   - 饼图：行业分布
   - 条形图：个股占比
   - 风险提示

3. **事件影响矩阵**
   - 表格：股票 × 事件
   - 颜色编码：正面影响（绿）、负面影响（红）、中性（灰）
   - 影响强度：数字或星级

4. **AI组合建议**
   - 调仓建议卡片：
     - 减仓股票（红色卡片）
     - 加仓股票（绿色卡片）
     - 轮动建议（蓝色卡片）
   - 每个建议包含：
     - 股票名称
     - 操作类型和数量
     - 理由说明
     - 预期效果

5. **风险分析**
   - 集中度风险
   - 行业风险
   - 事件风险
   - 缓解建议

---

### 3.3 模态框设计

#### 3.3.1 添加账户模态框
- 头部：渐变色背景（蓝紫）+ "添加新账户" + 关闭按钮
- 表单字段：
  - 证券公司（下拉选择）
  - 账户号码（文本输入）
  - 账户类型（单选：A股/A股+港股/美股）
  - 初始资金（数字输入，¥前缀）
  - 备注（文本域）
- 底部按钮："取消"、"确认添加"

#### 3.3.2 添加股票模态框
- 头部：绿蓝渐变 + "添加股票到自选" + 关闭按钮
- 表单字段：
  - 股票代码/名称（搜索输入框）
  - 关注度（单选：⭐⭐⭐⭐⭐ / ⭐⭐⭐⭐ / ⭐⭐⭐）
  - 备注（关注理由、预期价位）
- 底部按钮："取消"、"添加到自选"（绿色）

#### 3.3.3 记录交易模态框
- 头部：蓝紫渐变 + "记录交易" + 关闭按钮
- 表单字段：
  - 选择股票（下拉，持仓列表）
  - 交易类型（单选：📈 买入 / 📉 卖出）
  - 数量（股）
  - 成交价格
  - 交易时间（日期时间选择器）
  - 手续费
  - 备注（交易原因、市场情况）
- 底部按钮："取消"、"确认记录"

#### 3.3.4 个股操作策略模态框
- 头部：渐变色 + 股票图标名称代码 + 关闭按钮
- 策略列表：
  - 按优先级和状态排序
  - 卖出策略：红色边框卡片
  - 买入策略：绿色边框卡片
  - 已完成策略：灰色卡片（半透明）
  - 每条策略显示：
    - 类型标签（买入/卖出）
    - 日期
    - 触发条件（价格区间）
    - 操作数量
    - 策略理由
    - 状态（待执行/已执行）
    - 优先级

#### 3.3.5 策略复盘模态框
- 头部：紫粉渐变 + "📊 策略复盘" + 关闭按钮
- 时间选择器：
  - 复盘周期（下拉：最近一周/一月/三月/一年/自定义）
  - "生成复盘报告"按钮
- 复盘统计：
  - 4个指标卡片：交易次数、成功率、平均持仓、总收益
- 策略执行情况：
  - 成功案例（绿色卡片）
  - 错失机会（黄色卡片）
  - 失败案例（红色卡片）
- AI复盘建议：
  - 渐变背景框
  - 建议列表（带图标：✓ ! ×）

---

### 3.4 交互规范

#### 3.4.1 Tab切换
- 点击Tab标签切换内容
- 活动Tab：下边框高亮（蓝色）、文字深色
- 非活动Tab：无边框、文字灰色
- 悬停效果：背景变浅灰

#### 3.4.2 模态框
- 打开：body禁止滚动
- 关闭方式：
  - 点击右上角 × 按钮
  - 点击"取消"按钮
  - 点击模态框外部（遮罩层）
- 动画：淡入淡出

#### 3.4.3 折叠面板
- 点击折叠按钮展开/收起
- 箭头图标旋转180度
- 内容区域显示/隐藏
- 过渡动画：300ms

#### 3.4.4 按钮状态
- 默认：边框、文字颜色
- 悬停：背景色变化、阴影增强
- 点击：轻微缩小效果
- 禁用：灰色、不可点击

#### 3.4.5 颜色编码
- **持仓**：bg-blue-50, border-blue-200
- **关注**：bg-orange-50, border-orange-200
- **卖出/减仓**：bg-red-50, border-red-200, text-red-600
- **买入/加仓**：bg-green-50, border-green-200, text-green-600
- **观望/中性**：bg-yellow-50, border-yellow-200
- **已完成**：bg-gray-100, opacity-75

---

## 4. 数据库设计

（继承PRD v3的数据库设计）

**新增表**：

### 4.1 个股操作策略表（stock_strategies）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| user_id | UUID | 关联用户 |
| stock_id | UUID | 关联股票 |
| type | ENUM | 类型：buy, sell |
| trigger_price_min | DECIMAL | 触发价格下限 |
| trigger_price_max | DECIMAL | 触发价格上限 |
| quantity | INTEGER | 操作股数 |
| reason | TEXT | 策略理由 |
| priority | ENUM | 优先级：high, medium, low |
| status | ENUM | 状态：pending, executed, cancelled |
| created_at | TIMESTAMP | 创建时间 |
| executed_at | TIMESTAMP | 执行时间（可选） |
| notes | TEXT | 备注 |

---

## 5. API设计

**新增API**：

### 5.1 个股操作策略

```
POST /api/strategies
创建策略

GET /api/strategies?stock_id={id}
获取某股票的所有策略

PUT /api/strategies/{id}
更新策略

PATCH /api/strategies/{id}/execute
标记策略为已执行

DELETE /api/strategies/{id}
删除策略
```

### 5.2 快速操作

```
POST /api/quick-actions/add-watchlist
快速添加关注

POST /api/quick-actions/record-trade
快速记录交易

GET /api/quick-actions/strategy-review?range={period}
策略复盘
```

---

## 6. 实施计划

### Phase 1：基础框架（2周）
- 项目初始化
- 数据库表创建
- 用户认证系统
- 基础UI框架

### Phase 2：账户与持仓（2周）
- 账户管理
- 持仓管理
- 关注列表
- **新增**：持仓与关注合并展示

### Phase 3：交易与策略（2周）
- 交易记录
- **新增**：个股操作策略管理
- **新增**：快速操作模态框

### Phase 4：AI集成（2周）
- AI分析接口
- Token管理
- 策略生成
- **新增**：今日AI策略建议置顶

### Phase 5：事件系统（2周）
- 事件数据采集
- 事件分析与分类
- 事件影响分析
- 事件提醒系统

### Phase 6：UI完善（2周）
- **新增**：5个HTML原型转Vue组件
- **新增**：所有模态框实现
- **新增**：Tab切换和折叠面板
- 响应式适配

### Phase 7：复盘与优化（2周）
- 策略复盘功能
- 数据可视化（ECharts集成）
- 性能优化
- 测试与修复

### Phase 8：测试与上线（1周）
- 集成测试
- 用户测试
- 部署上线

---

## 7. 成功指标

### MVP阶段（3个月）
- 用户数：100+
- 日活用户：30+
- 策略生成次数：500+/周
- 交易记录数：200+/周
- **新增**：快速操作使用率：80%+
- **新增**：个股策略创建数：50+/周

### 产品成熟期（6个月）
- 用户数：1000+
- 日活用户：300+
- 策略执行率：60%+
- 复盘使用率：40%+
- **新增**：首页AI建议查看率：90%+
- **新增**：关注股票转化率：30%+

---

## 8. 未来扩展

### Phase 2（6个月后）
- **智能提醒系统**：
  - 价格触达提醒
  - 策略执行提醒
  - 事件推送通知

- **社区功能**：
  - 策略分享
  - 复盘交流
  - 高手榜单

### Phase 3（12个月后）
- **量化回测**：
  - 策略历史回测
  - 参数优化
  - 风险模拟

- **移动端App**：
  - iOS/Android原生应用
  - 推送通知
  - 快捷操作小组件

---

## 9. 附录

### 9.1 HTML原型文件
- `01-dashboard.html` - 首页
- `02-account-detail.html` - 账户详情页
- `03-stock-detail.html` - 股票详情页
- `04-event-center.html` - 事件中心
- `05-portfolio-analysis.html` - 持仓分析页
- `index.html` - 原型索引页

### 9.2 关键设计决策

1. **AI建议置顶**：
   - 理由：用户最关心"今天该怎么操作"
   - 效果：提升决策效率，减少认知负担

2. **持仓与关注合并**：
   - 理由：统一管理"我关心的股票"
   - 效果：减少页面跳转，便于对比

3. **个股操作策略**：
   - 理由：记录买卖计划，避免情绪化交易
   - 效果：提升策略执行率，便于复盘

4. **账户总览折叠**：
   - 理由：整体信息不需要天天看
   - 效果：为核心信息让出空间

5. **快速操作入口**：
   - 理由：降低高频操作的门槛
   - 效果：提升使用效率和满意度

### 9.3 技术栈

**前端**：
- Vue 3 + TypeScript
- Vite
- TailwindCSS
- Element Plus / Ant Design Vue
- ECharts / Chart.js

**后端**：
- NestJS + TypeScript
- PostgreSQL
- Prisma ORM
- JWT认证

**AI集成**：
- Claude API (Sonnet 4.5)
- Token管理与成本控制

**数据源（MCP）**：
- Brave Search - 新闻搜索
- PostgreSQL - 数据库访问
- Filesystem - 文件操作
- Memory - AI记忆

---

**文档版本**: v3.2
**生成时间**: 2025-01-14
**基于**: HTML原型 + PRD v3
**下一步**: 评审通过后进入开发阶段
