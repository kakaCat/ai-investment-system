# æµ‹è¯•ç­–ç•¥

> æŠ•èµ„ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•ç­–ç•¥ã€æ–¹æ³•å’Œè´¨é‡æ ‡å‡†

---

## ğŸ“ ç›®å½•

1. [æµ‹è¯•ç›®æ ‡](#æµ‹è¯•ç›®æ ‡)
2. [æµ‹è¯•é‡‘å­—å¡”](#æµ‹è¯•é‡‘å­—å¡”)
3. [æµ‹è¯•ç±»å‹](#æµ‹è¯•ç±»å‹)
4. [æµ‹è¯•ç¯å¢ƒ](#æµ‹è¯•ç¯å¢ƒ)
5. [è´¨é‡æ ‡å‡†](#è´¨é‡æ ‡å‡†)
6. [æµ‹è¯•æµç¨‹](#æµ‹è¯•æµç¨‹)
7. [å·¥å…·å’ŒæŠ€æœ¯æ ˆ](#å·¥å…·å’ŒæŠ€æœ¯æ ˆ)

---

## ğŸ¯ æµ‹è¯•ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡

1. **åŠŸèƒ½æ­£ç¡®æ€§**: ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æŒ‰ç…§PRDè¦æ±‚æ­£å¸¸å·¥ä½œ
2. **æ¶æ„ç¬¦åˆæ€§**: éªŒè¯ä»£ç éµå¾ªæ¶æ„çº¦æŸå’Œè®¾è®¡è§„èŒƒ
3. **æ•°æ®å®Œæ•´æ€§**: ä¿è¯æ•°æ®æ“ä½œçš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§
4. **ç”¨æˆ·ä½“éªŒ**: ç¡®ä¿UIäº¤äº’æµç•…ã€å“åº”åŠæ—¶
5. **å®‰å…¨æ€§**: éªŒè¯è®¤è¯ã€æˆæƒå’Œæ•°æ®ä¿æŠ¤æœºåˆ¶

### è´¨é‡ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ |
|------|--------|--------|
| ä»£ç è¦†ç›–ç‡ | > 80% | å¾…ç»Ÿè®¡ |
| å…³é”®è·¯å¾„è¦†ç›– | 100% | å¾…ç»Ÿè®¡ |
| UIæµ‹è¯•é€šè¿‡ç‡ | > 95% | 81.2% |
| APIæµ‹è¯•é€šè¿‡ç‡ | > 98% | 82.6% |
| ç¼ºé™·ä¿®å¤æ—¶é—´ | < 48å°æ—¶ | - |

---

## ğŸ“Š æµ‹è¯•é‡‘å­—å¡”

```
           E2Eæµ‹è¯• (10%)
          - ç”¨æˆ·å…³é”®è·¯å¾„
         - ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹
        - è·¨ç³»ç»Ÿé›†æˆéªŒè¯
       ----------------------

         é›†æˆæµ‹è¯• (30%)
       - APIç«¯ç‚¹æµ‹è¯•
      - æ•°æ®åº“é›†æˆæµ‹è¯•
     - ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
    -----------------------

        å•å…ƒæµ‹è¯• (60%)
      - Serviceå±‚é€»è¾‘
     - Converterè®¡ç®—
    - Builderæ„å»º
   - RepositoryæŸ¥è¯¢
  ------------------------
```

### æµ‹è¯•åˆ†å¸ƒåŸåˆ™

**60% å•å…ƒæµ‹è¯•**:
- å¿«é€Ÿæ‰§è¡Œï¼ˆ< 1ç§’ï¼‰
- é«˜è¦†ç›–ç‡
- æ—©æœŸå‘ç°é—®é¢˜
- æ˜“äºç»´æŠ¤

**30% é›†æˆæµ‹è¯•**:
- éªŒè¯ç»„ä»¶åä½œ
- æ•°æ®åº“æ“ä½œ
- å¤–éƒ¨æœåŠ¡è°ƒç”¨
- ä¸­ç­‰æ‰§è¡Œæ—¶é—´ï¼ˆ< 10ç§’ï¼‰

**10% E2Eæµ‹è¯•**:
- å…³é”®ç”¨æˆ·è·¯å¾„
- æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- è¾ƒé•¿æ‰§è¡Œæ—¶é—´ï¼ˆ< 60ç§’ï¼‰
- é«˜ç»´æŠ¤æˆæœ¬

---

## ğŸ§ª æµ‹è¯•ç±»å‹

### 1. å•å…ƒæµ‹è¯• (Unit Tests)

**ç›®çš„**: éªŒè¯å•ä¸ªå‡½æ•°ã€ç±»çš„é€»è¾‘æ­£ç¡®æ€§

**è¦†ç›–èŒƒå›´**:
- âœ… Serviceä¸šåŠ¡ç¼–æ’é€»è¾‘
- âœ… Converterè®¡ç®—å’Œè½¬æ¢
- âœ… Builderæ•°æ®æ„å»º
- âœ… Repositoryæ•°æ®è®¿é—®
- âœ… å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»

**æŠ€æœ¯æ ˆ**: pytest + unittest.mock

**ç¤ºä¾‹**:
```python
# tests/unit/services/test_account_detail_converter.py
def test_calculate_total_value():
    holdings = [
        Mock(quantity=100, current_price=10.5),
        Mock(quantity=200, current_price=5.2)
    ]
    result = AccountDetailConverter._calculate_total_value(holdings)
    assert result == 2090.0  # 100*10.5 + 200*5.2
```

### 2. é›†æˆæµ‹è¯• (Integration Tests)

**ç›®çš„**: éªŒè¯ç»„ä»¶é—´åä½œå’Œå¤–éƒ¨ä¾èµ–é›†æˆ

**è¦†ç›–èŒƒå›´**:
- âœ… APIç«¯ç‚¹ï¼ˆController â†’ Service â†’ Repository â†’ DBï¼‰
- âœ… æ•°æ®åº“æ“ä½œå’Œäº‹åŠ¡
- âœ… ç¬¬ä¸‰æ–¹APIè°ƒç”¨ï¼ˆDeepSeekã€Tushareï¼‰
- âœ… è®¤è¯å’Œæƒé™éªŒè¯

**æŠ€æœ¯æ ˆ**: pytest + FastAPI TestClient + PostgreSQL Test Database

**ç¤ºä¾‹**:
```python
# tests/integration/api/test_account_api.py
async def test_get_account_detail(client: TestClient):
    response = await client.post(
        "/api/v1/account/detail",
        json={"account_id": 1},
        headers={"Authorization": f"Bearer {token}"}
    )
    assert response.status_code == 200
    data = response.json()["data"]
    assert "account" in data
    assert "stats" in data
```

### 3. E2Eæµ‹è¯• (End-to-End Tests)

**ç›®çš„**: éªŒè¯å®Œæ•´ç”¨æˆ·æµç¨‹å’ŒUIäº¤äº’

**è¦†ç›–èŒƒå›´**:
- âœ… ç”¨æˆ·ç™»å½•è®¤è¯æµç¨‹
- âœ… è´¦æˆ·ç®¡ç†ï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- âœ… æŒä»“ç®¡ç†å’Œäº¤æ˜“è®°å½•
- âœ… äº‹ä»¶åˆ†æå’ŒAIåˆ†æ
- âœ… é¡µé¢å¯¼èˆªå’Œè·¯ç”±
- âœ… è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†

**æŠ€æœ¯æ ˆ**: Playwright + Python

**ç¤ºä¾‹**:
```python
# tests/ui/scripts/comprehensive_ui_test.py
async def test_account_management_flow(page: Page):
    # 1. ç™»å½•
    await page.goto("http://localhost:5175/login")
    await page.fill('input[type="text"]', "testuser")
    await page.fill('input[type="password"]', "Test123456")
    await page.click('button[type="submit"]')

    # 2. å¯¼èˆªåˆ°è´¦æˆ·é¡µé¢
    await page.click('a[href="/accounts"]')

    # 3. éªŒè¯åˆ—è¡¨åŠ è½½
    await page.wait_for_selector(".account-list")
```

### 4. æ€§èƒ½æµ‹è¯• (Performance Tests)

**ç›®çš„**: éªŒè¯ç³»ç»Ÿæ€§èƒ½å’Œèµ„æºä½¿ç”¨

**è¦†ç›–èŒƒå›´**:
- APIå“åº”æ—¶é—´
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- å‰ç«¯åŠ è½½é€Ÿåº¦
- å¹¶å‘ç”¨æˆ·å¤„ç†èƒ½åŠ›

**æŠ€æœ¯æ ˆ**: Locust / Apache JMeterï¼ˆå¾…å®ç°ï¼‰

### 5. å®‰å…¨æµ‹è¯• (Security Tests)

**ç›®çš„**: éªŒè¯å®‰å…¨æœºåˆ¶å’Œæ¼æ´é˜²æŠ¤

**è¦†ç›–èŒƒå›´**:
- SQLæ³¨å…¥é˜²æŠ¤
- XSSé˜²æŠ¤
- CSRFé˜²æŠ¤
- è®¤è¯å’Œæˆæƒæœºåˆ¶
- æ•æ„Ÿæ•°æ®åŠ å¯†

**æŠ€æœ¯æ ˆ**: OWASP ZAPï¼ˆå¾…å®ç°ï¼‰

---

## ğŸŒ æµ‹è¯•ç¯å¢ƒ

### ç¯å¢ƒé…ç½®

| ç¯å¢ƒ | ç”¨é€” | æ•°æ®åº“ | APIåœ°å€ |
|------|------|--------|---------|
| **æœ¬åœ°å¼€å‘** | å¼€å‘å’Œè°ƒè¯• | å¼€å‘åº“ | localhost:8000 |
| **æµ‹è¯•ç¯å¢ƒ** | è‡ªåŠ¨åŒ–æµ‹è¯• | æµ‹è¯•åº“ï¼ˆç‹¬ç«‹ï¼‰ | localhost:8000 |
| **CI/CD** | æŒç»­é›†æˆ | ä¸´æ—¶æµ‹è¯•åº“ | Dockerå®¹å™¨ |
| **é¢„å‘å¸ƒ** | ä¸Šçº¿å‰éªŒè¯ | é¢„å‘å¸ƒåº“ | staging.example.com |

### æµ‹è¯•æ•°æ®ç­–ç•¥

**1. å›ºå®šæµ‹è¯•æ•°æ®**:
- ç”¨æˆ·: `testuser` / `Test123456`
- é¢„ç½®è´¦æˆ·ã€æŒä»“ã€äº¤æ˜“è®°å½•
- é€šè¿‡ `seed_test_data.py` è„šæœ¬åˆå§‹åŒ–

**2. åŠ¨æ€æµ‹è¯•æ•°æ®**:
- æ¯æ¬¡æµ‹è¯•ç”Ÿæˆå”¯ä¸€æ•°æ®
- æµ‹è¯•ç»“æŸåæ¸…ç†
- é¿å…æ•°æ®æ±¡æŸ“

**3. æ•°æ®éš”ç¦»**:
- æµ‹è¯•æ•°æ®åº“ç‹¬ç«‹
- ä¸ä½¿ç”¨ç”Ÿäº§æ•°æ®
- æ•æ„Ÿæ•°æ®è„±æ•

---

## âœ… è´¨é‡æ ‡å‡†

### ä»£ç è¦†ç›–ç‡è¦æ±‚

| å±‚çº§ | æœ€ä½è¦†ç›–ç‡ | ç›®æ ‡è¦†ç›–ç‡ |
|------|-----------|-----------|
| **Serviceå±‚** | 80% | 90% |
| **Converterå±‚** | 90% | 95% |
| **Builderå±‚** | 80% | 90% |
| **Repositoryå±‚** | 70% | 80% |
| **APIå±‚** | 80% | 85% |
| **æ•´ä½“** | 80% | 85% |

### æµ‹è¯•é€šè¿‡æ ‡å‡†

**å•å…ƒæµ‹è¯•**:
- âœ… 100%é€šè¿‡ç‡
- âœ… æ— è·³è¿‡æµ‹è¯•ï¼ˆé™¤éæœ‰å……åˆ†ç†ç”±ï¼‰
- âœ… æ‰§è¡Œæ—¶é—´ < 30ç§’

**é›†æˆæµ‹è¯•**:
- âœ… > 95%é€šè¿‡ç‡
- âœ… æ‰§è¡Œæ—¶é—´ < 2åˆ†é’Ÿ
- âœ… æ•°æ®åº“æ¸…ç†å®Œæˆ

**E2Eæµ‹è¯•**:
- âœ… > 90%é€šè¿‡ç‡
- âœ… æ‰§è¡Œæ—¶é—´ < 5åˆ†é’Ÿ
- âœ… æˆªå›¾è¯æ®å®Œæ•´

### ç¼ºé™·ç®¡ç†æ ‡å‡†

| çº§åˆ« | å“åº”æ—¶é—´ | ä¿®å¤æ—¶é—´ | ä¼˜å…ˆçº§ |
|------|---------|---------|--------|
| **P0-é˜»æ–­** | ç«‹å³ | 4å°æ—¶ | æœ€é«˜ |
| **P1-ä¸¥é‡** | 2å°æ—¶ | 24å°æ—¶ | é«˜ |
| **P2-ä¸€èˆ¬** | 8å°æ—¶ | 48å°æ—¶ | ä¸­ |
| **P3-è½»å¾®** | 24å°æ—¶ | 1å‘¨ | ä½ |

---

## ğŸ”„ æµ‹è¯•æµç¨‹

### å¼€å‘é˜¶æ®µæµ‹è¯•æµç¨‹

```
1. éœ€æ±‚åˆ†æ
   â†“
2. ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆTDDï¼‰
   â†“
3. å®ç°åŠŸèƒ½ä»£ç 
   â†“
4. è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆæœ¬åœ°ï¼‰
   â†“
5. è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆæœ¬åœ°ï¼‰
   â†“
6. æäº¤ä»£ç 
   â†“
7. CI/CDè‡ªåŠ¨æµ‹è¯•
   â†“
8. Code Review + æµ‹è¯•æŠ¥å‘Š
   â†“
9. åˆå¹¶åˆ°ä¸»åˆ†æ”¯
```

### æµ‹è¯•æ‰§è¡Œé¡ºåº

**æœ¬åœ°å¼€å‘**:
1. å•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
2. é›†æˆæµ‹è¯•ï¼ˆéªŒè¯é›†æˆï¼‰
3. E2Eæµ‹è¯•ï¼ˆå…³é”®è·¯å¾„ï¼‰

**CI/CD**:
1. ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆLintingï¼‰
2. æ¶æ„ç¬¦åˆæ€§æ£€æŸ¥ï¼ˆ`check_architecture.py`ï¼‰
3. å•å…ƒæµ‹è¯•
4. é›†æˆæµ‹è¯•
5. E2Eæµ‹è¯•ï¼ˆå…³é”®åœºæ™¯ï¼‰
6. æ€§èƒ½æµ‹è¯•ï¼ˆå…³é”®APIï¼‰

### ç¼ºé™·å¤„ç†æµç¨‹

```
å‘ç°ç¼ºé™· â†’ è®°å½•åˆ° management/risks.md
    â†“
è¯„ä¼°ä¼˜å…ˆçº§ï¼ˆP0/P1/P2/P3ï¼‰
    â†“
åˆ†é…ç»™å¼€å‘äººå‘˜
    â†“
ä¿®å¤å¹¶æ·»åŠ æµ‹è¯•ç”¨ä¾‹
    â†“
å›å½’æµ‹è¯•éªŒè¯
    â†“
æ›´æ–°æµ‹è¯•æŠ¥å‘Š
    â†“
å…³é—­ç¼ºé™·
```

---

## ğŸ”§ å·¥å…·å’ŒæŠ€æœ¯æ ˆ

### åç«¯æµ‹è¯•

| å·¥å…· | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| **pytest** | æµ‹è¯•æ¡†æ¶ | 7.4+ |
| **pytest-asyncio** | å¼‚æ­¥æµ‹è¯•æ”¯æŒ | 0.21+ |
| **pytest-cov** | è¦†ç›–ç‡ç»Ÿè®¡ | 4.1+ |
| **FastAPI TestClient** | APIæµ‹è¯•å®¢æˆ·ç«¯ | - |
| **unittest.mock** | Mockå¯¹è±¡ | å†…ç½® |
| **faker** | æµ‹è¯•æ•°æ®ç”Ÿæˆ | 19.0+ |

### å‰ç«¯æµ‹è¯•

| å·¥å…· | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| **Playwright** | E2Eæµ‹è¯•æ¡†æ¶ | 1.40+ |
| **Vitest** | å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆå¾…å®ç°ï¼‰ | 1.0+ |
| **@vue/test-utils** | Vueç»„ä»¶æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰ | 2.4+ |

### æµ‹è¯•æŠ¥å‘Šå’Œç›‘æ§

| å·¥å…· | ç”¨é€” |
|------|------|
| **pytest-html** | HTMLæµ‹è¯•æŠ¥å‘Š |
| **coverage.py** | ä»£ç è¦†ç›–ç‡ |
| **Allure** | é«˜çº§æµ‹è¯•æŠ¥å‘Šï¼ˆå¾…å®ç°ï¼‰ |

---

## ğŸ“ˆ æµ‹è¯•æ”¹è¿›è·¯çº¿å›¾

### Phase 1 - åŸºç¡€æ¡†æ¶ï¼ˆå½“å‰é˜¶æ®µï¼‰ âœ…

- [x] UIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
- [x] æµ‹è¯•æ–‡æ¡£ç»“æ„
- [x] æµ‹è¯•æ•°æ®å‡†å¤‡è„šæœ¬
- [x] åŸºç¡€æµ‹è¯•æŠ¥å‘Š

### Phase 2 - å•å…ƒå’Œé›†æˆæµ‹è¯•ï¼ˆ1-2å‘¨ï¼‰

- [ ] Serviceå±‚å•å…ƒæµ‹è¯•
- [ ] Converter/Builderå•å…ƒæµ‹è¯•
- [ ] Repositoryå•å…ƒæµ‹è¯•
- [ ] APIé›†æˆæµ‹è¯•
- [ ] æ•°æ®åº“é›†æˆæµ‹è¯•

### Phase 3 - è´¨é‡æå‡ï¼ˆ1ä¸ªæœˆï¼‰

- [ ] ä»£ç è¦†ç›–ç‡ > 80%
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Š
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å®‰å…¨æµ‹è¯•åŸºç¡€

### Phase 4 - æŒç»­ä¼˜åŒ–ï¼ˆæŒç»­ï¼‰

- [ ] CI/CDå®Œå…¨é›†æˆ
- [ ] å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
- [ ] è§†è§‰å›å½’æµ‹è¯•
- [ ] A/Bæµ‹è¯•æ”¯æŒ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [UIæµ‹è¯•æŒ‡å—](../guides/ui-testing-guide.md)
- [é›†æˆæµ‹è¯•æŒ‡å—](../guides/integration-testing-guide.md)
- [å•å…ƒæµ‹è¯•æŒ‡å—](../guides/unit-testing-guide.md)
- [åç«¯æ¶æ„æ–‡æ¡£](../../design/architecture/backend-architecture.md)
- [äº§å“éœ€æ±‚æ–‡æ¡£](../../prd/v3/main.md)

---

## ğŸ“ ä¿®æ”¹å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ |
|------|------|---------|
| 2025-11-19 | v1.0 | åˆå§‹ç‰ˆæœ¬ï¼Œå®šä¹‰æ•´ä½“æµ‹è¯•ç­–ç•¥ |

---

**æœ€åæ›´æ–°**: 2025-11-19
**è´Ÿè´£äºº**: QA Team
**å®¡æ ¸äºº**: Architect Team
