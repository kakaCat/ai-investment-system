# 前端AI功能测试指南

> **文档类型**: 测试指南
> **创建时间**: 2025-11-20
> **Sprint**: Sprint 002
> **测试范围**: 前端AI功能集成（单股分析、AI对话、每日复盘）

---

## 📋 目录

1. [测试准备](#-测试准备)
2. [环境启动](#-环境启动)
3. [测试用例](#-测试用例)
4. [Bug报告模板](#-bug报告模板)
5. [测试检查清单](#-测试检查清单)

---

## 🔧 测试准备

### 前置条件

**后端服务**:
- [ ] 后端服务已启动 (http://localhost:8000)
- [ ] AI服务配置正确（Ollama或DeepSeek API）
- [ ] 数据源配置正确（Tushare/AkShare）
- [ ] 数据库已初始化

**前端服务**:
- [ ] 前端开发服务器已启动 (http://localhost:5175)
- [ ] 依赖包已安装 (`npm install`)
- [ ] 环境变量配置正确

**测试数据**:
- [ ] 至少有1个测试用户账户
- [ ] 数据库中有股票基础数据
- [ ] 准备测试股票代码（推荐：600519贵州茅台、000001平安银行）

### 测试工具

- **浏览器**: Chrome/Firefox 最新版
- **开发者工具**: Network、Console、Vue DevTools
- **测试账号**: 准备好登录凭证
- **日志查看**: `tail -f scripts/logs/backend.log`

---

## 🚀 环境启动

### 方法1: 使用启动脚本（推荐）

```bash
# 进入项目根目录
cd /Users/mac/Documents/ai/stock

# 启动开发环境
./scripts/dev.sh

# 等待服务就绪（约10-15秒）
# ✅ 后端服务已就绪: http://localhost:8000
# ✅ 前端服务已就绪: http://localhost:5175
```

### 方法2: 手动启动

**后端**:
```bash
cd backend
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**前端**:
```bash
cd frontend
npm run dev
```

### 健康检查

访问以下URL确认服务正常：

- 后端健康检查: http://localhost:8000/health
- 后端API文档: http://localhost:8000/docs
- 前端首页: http://localhost:5175

---

## ✅ 测试用例

### TC-001: 单股AI分析 - 完整流程

**测试目标**: 验证用户能成功完成单股AI分析全流程

#### 前置条件
- 用户已登录
- 后端AI服务正常运行

#### 测试步骤

1. **导航到AI分析中心**
   - 操作: 点击左侧菜单 "AI分析中心"
   - 预期: 进入 `/analysis` 页面

2. **打开单股分析对话框**
   - 操作: 点击"单股AI分析"卡片
   - 预期: 弹出"单股分析配置"对话框

3. **选择股票**
   - 操作: 点击"选择股票"按钮
   - 预期: 弹出股票搜索对话框
   - 操作: 搜索"600519"或"贵州茅台"
   - 预期: 显示搜索结果
   - 操作: 选择股票并确认
   - 预期: 返回配置对话框，显示已选股票信息

4. **配置分析维度**
   - 操作: 勾选"基本面分析"和"技术面分析"
   - 预期: 复选框状态正确显示

5. **开始AI分析**
   - 操作: 点击"开始AI分析"按钮
   - 预期:
     - 按钮变为"AI分析中...(约30秒)"
     - 按钮进入loading状态
   - 等待: 约30秒（Ollama）或3秒（DeepSeek）

6. **查看分析结果**
   - 预期:
     - 对话框标题变为"AI分析结果"
     - 显示综合评分（大号数字，带颜色）
     - 显示分维度评分（进度条）
     - 显示AI投资建议（文本）
     - 显示置信度等级
     - 显示数据来源标签

7. **验证结果数据**
   - [ ] 综合评分在0-100范围内
   - [ ] 评分颜色编码正确（80+绿色、60-79蓝色、40-59橙色、<40红色）
   - [ ] 基本面/技术面评分显示
   - [ ] AI建议内容合理
   - [ ] 置信度显示正常

8. **返回重新配置**
   - 操作: 点击"返回配置"按钮
   - 预期: 返回配置视图，保留之前选择的股票

9. **重新分析**
   - 操作: 修改分析维度，再次点击"开始AI分析"
   - 预期: 成功获取新的分析结果

10. **关闭对话框**
    - 操作: 点击"关闭"按钮
    - 预期: 对话框关闭，返回AI分析中心

#### 验收标准

- [ ] 所有步骤按预期执行
- [ ] 无JavaScript错误（检查Console）
- [ ] 无网络请求失败（检查Network）
- [ ] Loading状态显示正确
- [ ] 数据展示完整清晰
- [ ] 交互响应流畅

---

### TC-002: AI投资对话 - 多轮对话

**测试目标**: 验证AI对话功能支持多轮上下文对话

#### 测试步骤

1. **打开AI对话窗口**
   - 操作: 在AI分析中心点击"AI投资对话"卡片
   - 预期: 弹出AI对话窗口

2. **发送第一条消息（无股票上下文）**
   - 操作: 输入"什么是价值投资？"
   - 操作: 点击发送或按Enter
   - 预期:
     - 消息添加到对话列表
     - AI头像显示"思考中..."动画
     - 约3-5秒后显示AI回复

3. **验证AI回复**
   - [ ] 回复内容与问题相关
   - [ ] 回复格式清晰
   - [ ] 时间戳正确

4. **发送第二条消息（上下文相关）**
   - 操作: 输入"如何应用到A股市场？"
   - 预期: AI理解上下文，回复与前一问题相关

5. **发送第三条消息（股票特定）**
   - 操作: 关闭对话框，从股票列表进入（带symbol和stockName）
   - 操作: 输入"这只股票现在适合加仓吗？"
   - 预期: AI回复针对该股票的具体建议

6. **测试快速输入**
   - 操作: 连续发送多条消息
   - 预期:
     - 前一条消息未完成时，不能发送新消息
     - 输入框disabled状态正确

7. **清空对话**
   - 操作: 点击"清空对话"按钮（如果有）
   - 预期: 对话历史清空，保留欢迎消息

#### 验收标准

- [ ] 对话上下文正确维护（最近10条消息）
- [ ] AI回复质量符合预期
- [ ] Loading状态显示正确
- [ ] 错误处理正常（网络断开时）

---

### TC-003: 每日市场复盘 - 数据加载

**测试目标**: 验证每日复盘页面数据加载

#### 测试步骤

1. **导航到每日复盘页面**
   - 操作: 点击左侧菜单"每日复盘"或从AI分析中心点击"每日市场复盘"
   - 预期: 进入 `/review/daily` 页面

2. **检查初始加载**
   - 预期:
     - 页面显示当前日期
     - 显示Mock数据或真实数据（取决于后端状态）

3. **验证数据展示**
   - [ ] 市场总结文本完整
   - [ ] 热点板块列表显示
   - [ ] 个股分析列表显示
   - [ ] 明日关注点显示

4. **测试刷新功能**（如果有）
   - 操作: 点击刷新按钮
   - 预期: 重新加载最新数据

#### 验收标准

- [ ] 页面加载无错误
- [ ] 数据展示格式正确
- [ ] 日期显示准确

---

### TC-004: 错误处理 - 网络异常

**测试目标**: 验证网络错误时的用户提示

#### 测试步骤

1. **模拟后端离线**
   - 操作: 停止后端服务 `./scripts/stop.sh`
   - 保持前端运行

2. **尝试单股分析**
   - 操作: 按TC-001步骤进行单股分析
   - 预期:
     - 显示友好错误提示
     - 提示内容包含具体错误信息
     - 不出现技术性错误堆栈

3. **尝试AI对话**
   - 操作: 发送对话消息
   - 预期:
     - AI回复显示错误消息
     - 错误消息格式友好

4. **恢复后端**
   - 操作: 重新启动后端 `./scripts/dev.sh`
   - 操作: 再次尝试分析
   - 预期: 功能恢复正常

#### 验收标准

- [ ] 所有错误都有用户友好提示
- [ ] 无未捕获的JavaScript异常
- [ ] Console无红色错误（Network错误除外）

---

### TC-005: Loading状态 - 时间估计

**测试目标**: 验证长时间AI操作的Loading体验

#### 测试步骤

1. **单股分析Loading**
   - 操作: 开始单股AI分析
   - 验证:
     - [ ] 显示"AI正在分析中，预计需要30秒..."
     - [ ] 显示旋转Loading图标
     - [ ] 按钮显示"AI分析中...(约30秒)"
     - [ ] 按钮进入disabled状态

2. **AI对话Loading**
   - 操作: 发送对话消息
   - 验证:
     - [ ] AI头像显示"思考中..."
     - [ ] 输入框disabled
     - [ ] 发送按钮disabled

3. **计时验证**
   - 操作: 使用秒表计时实际响应时间
   - 记录:
     - Ollama响应时间: _____秒
     - DeepSeek响应时间: _____秒
   - 验证: 实际时间与提示一致

#### 验收标准

- [ ] 所有Loading状态清晰可见
- [ ] 时间估计准确（±5秒）
- [ ] Loading完成后状态正确恢复

---

### TC-006: 数据来源标签 - 显示正确性

**测试目标**: 验证数据来源标签正确显示

#### 测试步骤

1. **检查分析结果数据源**
   - 操作: 完成单股分析
   - 验证:
     - [ ] 显示数据来源标签（Tushare/AkShare/Mock）
     - [ ] 标签颜色正确：
       - Tushare: 绿色（success）
       - AkShare: 蓝色（primary）
       - Mock: 橙色（warning）

2. **检查后端日志**
   - 操作: 查看 `scripts/logs/backend.log`
   - 验证: 确认实际使用的数据源与前端显示一致

#### 验收标准

- [ ] 数据来源标签显示准确
- [ ] 标签颜色符合规范
- [ ] 与后端实际使用的数据源一致

---

### TC-007: 快速模板 - 一键配置

**测试目标**: 验证快速模板功能

#### 测试步骤

1. **测试"快速分析"模板**
   - 操作: 在单股分析配置中点击"快速分析"
   - 预期:
     - 自动勾选"基本面分析"+"技术面分析"
     - 时间范围设为"近3个月"
     - 不包含相关事件
     - 包含财报数据
     - 不对比同行业公司
     - 显示成功提示

2. **测试"全面分析"模板**
   - 操作: 点击"全面分析"
   - 预期:
     - 勾选所有6个分析维度
     - 时间范围设为"近1年"
     - 所有选项全选

3. **测试"价值投资"模板**
   - 操作: 点击"价值投资"
   - 预期:
     - 勾选"基本面+估值+行业"
     - 时间范围设为"近3年"
     - 对比同行业公司
     - 自定义问题自动填入

#### 验收标准

- [ ] 所有模板配置正确
- [ ] 成功提示显示
- [ ] 配置可以手动修改

---

## 🐛 Bug报告模板

发现Bug时请使用以下模板记录：

```markdown
### Bug #XXX: [简短描述]

**严重程度**: 🔴严重 / 🟡一般 / 🟢轻微

**测试用例**: TC-XXX

**复现步骤**:
1. 步骤1
2. 步骤2
3. ...

**预期结果**:
应该显示/执行...

**实际结果**:
实际显示/执行...

**截图/日志**:
[粘贴截图或错误日志]

**环境信息**:
- 浏览器: Chrome 120.0.0
- 操作系统: macOS 14.0
- 后端版本: [git commit hash]
- 前端版本: [git commit hash]

**Console错误**:
```
[粘贴Console错误信息]
```

**Network请求**:
- 请求URL: POST /api/v1/ai/single-analysis
- 状态码: 500
- 响应: {...}
```

---

## 📊 测试检查清单

### 功能测试

**单股AI分析**:
- [ ] TC-001: 完整流程正常
- [ ] TC-005: Loading状态正确
- [ ] TC-006: 数据来源标签显示
- [ ] TC-007: 快速模板功能

**AI对话**:
- [ ] TC-002: 多轮对话正常
- [ ] TC-002: 上下文理解正确
- [ ] TC-005: Loading状态正确

**每日复盘**:
- [ ] TC-003: 数据加载正常
- [ ] 页面展示完整

**错误处理**:
- [ ] TC-004: 网络异常处理
- [ ] 所有错误友好提示

### 性能测试

- [ ] 单股分析响应时间 < 35秒（Ollama）或 < 5秒（DeepSeek）
- [ ] AI对话响应时间 < 10秒（Ollama）或 < 3秒（DeepSeek）
- [ ] 页面加载时间 < 2秒
- [ ] 无明显卡顿或延迟

### 兼容性测试

**浏览器**:
- [ ] Chrome 最新版
- [ ] Firefox 最新版
- [ ] Safari 最新版（macOS）

**分辨率**:
- [ ] 1920x1080（桌面）
- [ ] 1366x768（笔记本）
- [ ] 响应式布局正常

### UI/UX测试

**视觉**:
- [ ] 评分颜色编码正确
- [ ] 进度条显示流畅
- [ ] Loading动画正常
- [ ] 字体大小合适
- [ ] 间距布局合理

**交互**:
- [ ] 按钮点击响应及时
- [ ] 对话框打开/关闭流畅
- [ ] 滚动流畅无卡顿
- [ ] 消息提示位置合理

### 代码质量

**Console检查**:
- [ ] 无红色错误（Network除外）
- [ ] 无黄色警告
- [ ] 无未使用的变量警告

**Network检查**:
- [ ] API请求URL正确
- [ ] 请求方法为POST
- [ ] 响应状态码正确（200/400/500）
- [ ] 响应数据格式符合类型定义

**Vue DevTools检查**:
- [ ] 组件层级合理
- [ ] Props传递正确
- [ ] 状态管理正确

---

## 📈 测试进度跟踪

### 测试执行记录

| 测试用例 | 执行人 | 执行日期 | 状态 | Bug数量 | 备注 |
|---------|--------|---------|------|---------|------|
| TC-001 | - | - | ⏳待测试 | - | - |
| TC-002 | - | - | ⏳待测试 | - | - |
| TC-003 | - | - | ⏳待测试 | - | - |
| TC-004 | - | - | ⏳待测试 | - | - |
| TC-005 | - | - | ⏳待测试 | - | - |
| TC-006 | - | - | ⏳待测试 | - | - |
| TC-007 | - | - | ⏳待测试 | - | - |

### Bug统计

- 🔴 严重Bug: 0
- 🟡 一般Bug: 0
- 🟢 轻微Bug: 0
- **总计**: 0

### 测试覆盖率

- 功能测试: 0/7 (0%)
- 性能测试: 0/4 (0%)
- 兼容性测试: 0/5 (0%)
- UI/UX测试: 0/9 (0%)

---

## 🎯 测试完成标准

**通过标准**:
- [ ] 所有测试用例执行完成
- [ ] 功能测试通过率 ≥ 95%
- [ ] 性能指标符合要求
- [ ] 🔴严重Bug = 0
- [ ] 🟡一般Bug ≤ 2
- [ ] Console无未处理错误
- [ ] 代码Review通过

**发布前检查**:
- [ ] 所有已知Bug已修复或记录
- [ ] 测试报告已生成
- [ ] 性能基准已建立
- [ ] 用户手册已更新

---

## 📚 相关文档

- [前端AI集成完成报告](../FRONTEND-AI-INTEGRATION-COMPLETE.md)
- [后端AI实现总结](../AI-IMPLEMENTATION-SUMMARY.md)
- [API文档](../../backend/app/api/README.md)
- [Sprint 002计划](../../management/sprints/sprint-002.md)

---

**文档版本**: v1.0
**最后更新**: 2025-11-20
**维护者**: QA Team
**状态**: ✅ 测试文档已完成，等待开始测试
