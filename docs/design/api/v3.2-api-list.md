# v3.2 APIæ¥å£åˆ—è¡¨

> åŸºäºå‰ç«¯é¡µé¢å®ç°ç”Ÿæˆçš„å®Œæ•´APIæ¥å£æ¸…å•

**ç‰ˆæœ¬**: v3.2
**æœ€åæ›´æ–°**: 2025-01-17
**å¯¹åº”PRD**: [docs/prd/v3/sections/02-core-features.md](../../prd/v3/sections/02-core-features.md) Section 2.11

---

## ğŸ“‹ ç›®å½•

- [1. ç”¨æˆ·è‚¡ç¥¨è¯„ä»· API](#1-ç”¨æˆ·è‚¡ç¥¨è¯„ä»·-api)
- [2. æ¯æ—¥AIåˆ†æ API](#2-æ¯æ—¥aiåˆ†æ-api)
- [3. æ¯æ—¥å¤ç›˜ API](#3-æ¯æ—¥å¤ç›˜-api)
- [4. AIå¯¹è¯ API](#4-aiå¯¹è¯-api)
- [5. æ•°æ®æ¨¡å‹](#5-æ•°æ®æ¨¡å‹)

---

## 1. ç”¨æˆ·è‚¡ç¥¨è¯„ä»· API

### 1.1 è·å–è‚¡ç¥¨è¯„ä»·

**ç»„ä»¶**: `StockReview.vue`

```
GET /api/v1/reviews/{symbol}
```

**è·¯å¾„å‚æ•°**:
- `symbol` (string): è‚¡ç¥¨ä»£ç ï¼Œå¦‚ "600600"

**Queryå‚æ•°**:
- `user_id` (number): ç”¨æˆ·ID

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "review_id": 123,
    "user_id": 1,
    "symbol": "600600",
    "stock_name": "é’å²›å•¤é…’",
    "rating": 4,
    "bullish_reasons": [
      "æ–°èƒ½æºæ±½è½¦é¾™å¤´ï¼Œå¸‚å ç‡35%ç¨³å±…ç¬¬ä¸€",
      "æŠ€æœ¯ç ”å‘æŠ•å…¥å¤§ï¼Œäº§å“ç«äº‰åŠ›å¼º"
    ],
    "bearish_reasons": [
      "ä¼°å€¼åé«˜ï¼ŒPE 45å€",
      "è¡Œä¸šç«äº‰åŠ å‰§ï¼Œä»·æ ¼æˆ˜é£é™©"
    ],
    "holding_logic": "é•¿æœŸçœ‹å¥½æ–°èƒ½æºæ±½è½¦è¡Œä¸š...",
    "target_price": 280.00,
    "stop_loss_price": 180.00,
    "strategy_notes": "ç­‰å¾…å›è°ƒè‡³220-230åŒºé—´åŠ ä»“",
    "last_updated": "2025-01-17T14:30:00Z",
    "created_at": "2025-01-05T09:20:00Z"
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "code": 404,
  "message": "è¯¥è‚¡ç¥¨å°šæœªè¯„ä»·"
}
```

---

### 1.2 åˆ›å»º/æ›´æ–°è‚¡ç¥¨è¯„ä»·

**ç»„ä»¶**: `StockReview.vue`

```
POST /api/v1/reviews/{symbol}
PUT /api/v1/reviews/{symbol}
```

**è·¯å¾„å‚æ•°**:
- `symbol` (string): è‚¡ç¥¨ä»£ç 

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,
  "rating": 4,
  "bullish_reasons": [
    "æ–°èƒ½æºæ±½è½¦é¾™å¤´ï¼Œå¸‚å ç‡35%ç¨³å±…ç¬¬ä¸€",
    "æŠ€æœ¯ç ”å‘æŠ•å…¥å¤§ï¼Œäº§å“ç«äº‰åŠ›å¼º"
  ],
  "bearish_reasons": [
    "ä¼°å€¼åé«˜ï¼ŒPE 45å€"
  ],
  "holding_logic": "é•¿æœŸçœ‹å¥½æ–°èƒ½æºæ±½è½¦è¡Œä¸š...",
  "target_price": 280.00,
  "stop_loss_price": 180.00,
  "strategy_notes": "ç­‰å¾…å›è°ƒè‡³220-230åŒºé—´åŠ ä»“"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "è¯„ä»·å·²ä¿å­˜",
  "data": {
    "review_id": 123,
    "updated_at": "2025-01-17T14:30:00Z"
  }
}
```

---

### 1.3 è·å–è¯„ä»·æ—¥å¿—

**ç»„ä»¶**: `StockReview.vue` (æ“ä½œæ—¥å¿—éƒ¨åˆ†)

```
GET /api/v1/reviews/{symbol}/logs
```

**è·¯å¾„å‚æ•°**:
- `symbol` (string): è‚¡ç¥¨ä»£ç 

**Queryå‚æ•°**:
- `user_id` (number): ç”¨æˆ·ID
- `limit` (number, optional): è¿”å›æ¡æ•°ï¼Œé»˜è®¤20
- `offset` (number, optional): åç§»é‡ï¼Œé»˜è®¤0

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "total": 15,
    "logs": [
      {
        "id": 1,
        "log_type": "rating_changed",
        "description": "è¯„åˆ†ä» 3æ˜Ÿ è°ƒæ•´ä¸º 4æ˜Ÿ",
        "note": "çœ‹å¥½å…¬å¸é•¿æœŸå‘å±•",
        "change_snapshot": {
          "old_rating": 3,
          "new_rating": 4
        },
        "stock_price_at_time": 248.20,
        "holding_quantity": 500,
        "holding_cost": 235.80,
        "created_at": "2025-01-15T14:30:00Z"
      },
      {
        "id": 2,
        "log_type": "target_price_updated",
        "description": "ç›®æ ‡ä»·ä» Â¥260 è°ƒæ•´ä¸º Â¥280",
        "note": "ä¸Šè°ƒç›ˆåˆ©é¢„æœŸ",
        "change_snapshot": {
          "old_target": 260.00,
          "new_target": 280.00
        },
        "stock_price_at_time": 245.50,
        "created_at": "2025-01-10T09:20:00Z"
      }
    ]
  }
}
```

---

## 2. æ¯æ—¥AIåˆ†æ API

### 2.1 è·å–å¯åˆ†æè‚¡ç¥¨åˆ—è¡¨

**ç»„ä»¶**: `DailyAIAnalysis.vue`

```
GET /api/v1/ai/daily-analysis/stocks
```

**Queryå‚æ•°**:
- `user_id` (number): ç”¨æˆ·ID
- `account_id` (number, optional): è´¦æˆ·IDï¼Œä¸ä¼ åˆ™è¿”å›æ‰€æœ‰è´¦æˆ·

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "holdings": [
      {
        "symbol": "600600",
        "name": "é’å²›å•¤é…’",
        "market": "Aè‚¡",
        "current_price": 62.50,
        "change_rate": -4.87,
        "quantity": 1600,
        "emoji": "ğŸº"
      },
      {
        "symbol": "002594",
        "name": "æ¯”äºšè¿ª",
        "market": "Aè‚¡",
        "current_price": 248.20,
        "change_rate": 2.30,
        "quantity": 500,
        "emoji": "ğŸš—"
      }
    ],
    "watchlist": [
      {
        "symbol": "601398",
        "name": "å·¥å•†é“¶è¡Œ",
        "market": "Aè‚¡",
        "current_price": 5.82,
        "change_rate": 0.50,
        "emoji": "ğŸ¦"
      }
    ]
  }
}
```

---

### 2.2 æ‰¹é‡AIåˆ†æï¼ˆå¼‚æ­¥ï¼‰

**ç»„ä»¶**: `DailyAIAnalysis.vue`

```
POST /api/v1/ai/daily-analysis
```

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,
  "account_id": 1,
  "symbols": ["600600", "002594", "00700"],
  "analysis_type": "daily",
  "options": {
    "include_fundamentals": true,
    "include_technicals": true,
    "include_valuation": true,
    "include_strategy": true
  }
}
```

**å“åº”**:
```json
{
  "code": 202,
  "message": "åˆ†æä»»åŠ¡å·²åˆ›å»º",
  "data": {
    "task_id": "task_abc123",
    "status": "processing",
    "total_stocks": 3,
    "estimated_tokens": 7500,
    "estimated_cost": 1.05,
    "created_at": "2025-01-17T14:30:00Z"
  }
}
```

---

### 2.3 æŸ¥è¯¢åˆ†æè¿›åº¦

**ç»„ä»¶**: `DailyAIAnalysis.vue` (è½®è¯¢ä½¿ç”¨)

```
GET /api/v1/ai/daily-analysis/{task_id}/progress
```

**è·¯å¾„å‚æ•°**:
- `task_id` (string): ä»»åŠ¡ID

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "task_id": "task_abc123",
    "status": "processing",
    "total_stocks": 3,
    "completed_stocks": 1,
    "current_analyzing": "æ¯”äºšè¿ª (002594)",
    "progress": 33,
    "results": [
      {
        "symbol": "600600",
        "name": "é’å²›å•¤é…’",
        "status": "completed",
        "ai_score": 7.2,
        "completed_at": "2025-01-17T14:31:00Z"
      }
    ],
    "errors": []
  }
}
```

**çŠ¶æ€å€¼**:
- `pending`: ç­‰å¾…ä¸­
- `processing`: åˆ†æä¸­
- `completed`: å·²å®Œæˆ
- `failed`: å¤±è´¥
- `partial`: éƒ¨åˆ†å®Œæˆ

---

### 2.4 è·å–åˆ†æç»“æœ

**ç»„ä»¶**: `DailyAIAnalysis.vue`

```
GET /api/v1/ai/daily-analysis/{task_id}/results
```

**è·¯å¾„å‚æ•°**:
- `task_id` (string): ä»»åŠ¡ID

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "task_id": "task_abc123",
    "status": "completed",
    "total_tokens_used": 7380,
    "actual_cost": 1.03,
    "completed_at": "2025-01-17T14:35:00Z",
    "results": [
      {
        "symbol": "600600",
        "name": "é’å²›å•¤é…’",
        "ai_score": 7.2,
        "fundamental_score": 7.5,
        "technical_score": 6.8,
        "valuation_score": 7.3,
        "suggestion": "å»ºè®®åŠ ä»“",
        "strategy": {
          "target_price": "Â¥68-70",
          "position_size": "å»ºè®®å¢æŒè‡³ç»„åˆ10-12%ï¼ˆå½“å‰7.3%ï¼‰",
          "risk_control": "æ­¢æŸä½: Â¥55ï¼ˆ-15%ï¼‰ï¼Œä¸¥æ ¼æ‰§è¡Œ"
        },
        "detailed_analysis": {
          "fundamentals": {
            "score": 7.5,
            "strengths": ["å“ç‰Œå½±å“åŠ›å¼º", "å¸‚åœºä»½é¢ç¨³å®š"],
            "weaknesses": ["æˆæœ¬ä¸Šå‡", "é”€é‡ç–²è½¯"],
            "summary": "åŸºæœ¬é¢è‰¯å¥½ï¼ŒçŸ­æœŸå—æˆæœ¬å‹åŠ›å½±å“"
          },
          "technicals": {
            "score": 6.8,
            "trend": "ä¸‹è·Œè¶‹åŠ¿",
            "support_levels": [60.00, 58.00],
            "resistance_levels": [65.00, 68.00],
            "indicators": {
              "ma5": 63.20,
              "ma10": 64.50,
              "ma20": 66.30,
              "rsi": 42,
              "macd": "æ­»å‰"
            },
            "summary": "æŠ€æœ¯é¢åå¼±ï¼Œç­‰å¾…ä¼ç¨³ä¿¡å·"
          },
          "valuation": {
            "score": 7.3,
            "pe": 25.6,
            "pb": 3.8,
            "industry_pe_avg": 28.5,
            "evaluation": "ä¼°å€¼åˆç†åä½",
            "summary": "ç›¸æ¯”è¡Œä¸šå¹³å‡ä¼°å€¼æœ‰å®‰å…¨è¾¹é™…"
          }
        },
        "confidence": 0.78,
        "analyzed_at": "2025-01-17T14:35:00Z"
      }
    ]
  }
}
```

---

## 3. æ¯æ—¥å¤ç›˜ API

### 3.1 è·å–æ¯æ—¥å¤ç›˜æŠ¥å‘Š

**ç»„ä»¶**: `DailyReview.vue`

```
GET /api/v1/ai/daily-review
```

**Queryå‚æ•°**:
- `user_id` (number): ç”¨æˆ·ID
- `account_id` (number, optional): è´¦æˆ·ID
- `date` (string, optional): æ—¥æœŸ (YYYY-MM-DD)ï¼Œé»˜è®¤ä»Šå¤©

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "review_id": "review_20250117",
    "date": "2025-01-17",
    "user_id": 1,

    "market_summary": {
      "index_name": "ä¸Šè¯æŒ‡æ•°",
      "index_points": "3,245.67",
      "index_change": "+0.85%",
      "index_change_points": "+27.32",
      "hot_sectors": [
        {
          "name": "æ–°èƒ½æºæ±½è½¦",
          "change": "+3.2%",
          "leader": "æ¯”äºšè¿ª +5.8%",
          "reason": "æ–°èƒ½æºè¡¥è´´æ”¿ç­–å»¶é•¿"
        },
        {
          "name": "äººå·¥æ™ºèƒ½",
          "change": "+2.8%",
          "leader": "ç§‘å¤§è®¯é£ +6.2%",
          "reason": "ChatGPTæ¦‚å¿µæŒç»­ç«çƒ­"
        }
      ],
      "weak_sectors": [
        {
          "name": "æˆ¿åœ°äº§",
          "change": "-1.8%",
          "leader": "ä¸‡ç§‘A -3.2%",
          "reason": "å¸‚åœºä¿¡å¿ƒä¸è¶³"
        }
      ]
    },

    "portfolio_performance": {
      "today_profit": 3200,
      "today_profit_rate": 0.92,
      "top_gainers": [
        {
          "symbol": "002594",
          "name": "æ¯”äºšè¿ª",
          "change_rate": 2.3,
          "profit_value": 1200,
          "current_price": 248.20,
          "quantity": 500
        }
      ],
      "top_losers": [
        {
          "symbol": "600600",
          "name": "é’å²›å•¤é…’",
          "change_rate": -4.87,
          "loss_value": -2100,
          "current_price": 62.50,
          "quantity": 1600
        }
      ]
    },

    "important_events": [
      {
        "id": 1,
        "type": "policy",
        "level": "high",
        "title": "ç¾è”å‚¨åŠ æ¯25ä¸ªåŸºç‚¹",
        "impact": "åˆ©ç©º",
        "affected_stocks": ["00700", "09988"],
        "description": "é¢„è®¡ç§‘æŠ€è‚¡çŸ­æœŸæ‰¿å‹ï¼Œå»ºè®®å‡ä»“è§‚æœ›",
        "event_date": "2025-01-17"
      }
    ],

    "tomorrow_prediction": {
      "market_outlook": {
        "direction": "éœ‡è¡ä¸Šè¡Œ",
        "range": "3,250 - 3,280",
        "support": "3,230",
        "resistance": "3,280",
        "volume_expectation": "æˆäº¤é‡å¯èƒ½æ”¾å¤§ï¼Œèµ„é‡‘æƒ…ç»ªè½¬æš–",
        "confidence": 0.72
      },
      "focus_sectors": [
        "æ–°èƒ½æºæ±½è½¦",
        "äººå·¥æ™ºèƒ½",
        "ChatGPTæ¦‚å¿µ",
        "åŠå¯¼ä½“"
      ],
      "risks": [
        "ç¾è”å‚¨åŠ æ¯å½±å“å°šæœªå®Œå…¨æ¶ˆåŒ–",
        "éƒ¨åˆ†æ¿å—ä¼°å€¼åé«˜",
        "å¤–èµ„æµå‡ºå‹åŠ›"
      ],
      "suggestions": [
        "æ–°èƒ½æºæ¿å—å¯é€¢ä½åŠ ä»“",
        "é«˜ä¼°å€¼ç§‘æŠ€è‚¡å»ºè®®å‡ä»“",
        "å…³æ³¨æ”¿ç­–å—ç›Šæ¿å—",
        "æ§åˆ¶ä»“ä½ï¼Œä¿æŒçµæ´»"
      ]
    },

    "weekly_outlook": {
      "trend": "éœ‡è¡åå¼º",
      "key_events": [
        {
          "date": "2025-01-19",
          "event": "CPIæ•°æ®å…¬å¸ƒ"
        },
        {
          "date": "2025-01-21",
          "event": "å¤šå®¶ç§‘æŠ€å…¬å¸å‘å¸ƒè´¢æŠ¥"
        }
      ],
      "opportunities": [
        "æ–°èƒ½æºæ±½è½¦äº§ä¸šé“¾",
        "äººå·¥æ™ºèƒ½åº”ç”¨è½åœ°"
      ],
      "concerns": [
        "å®è§‚ç»æµæ•°æ®ä½äºé¢„æœŸ",
        "åœ°ç¼˜æ”¿æ²»é£é™©"
      ]
    },

    "user_views_summary": [
      {
        "symbol": "002594",
        "name": "æ¯”äºšè¿ª",
        "my_rating": 5,
        "ai_score": 8.8,
        "alignment": "high",
        "note": "é•¿æœŸçœ‹å¥½æ–°èƒ½æºæ±½è½¦é¾™å¤´"
      },
      {
        "symbol": "601398",
        "name": "å·¥å•†é“¶è¡Œ",
        "my_rating": 3,
        "ai_score": 7.5,
        "alignment": "medium",
        "note": "å­˜åœ¨è§‚ç‚¹åˆ†æ­§ï¼Œéœ€é‡æ–°è¯„ä¼°"
      }
    ],

    "generated_at": "2025-01-17T16:00:00Z",
    "tokens_used": 3500,
    "generation_cost": 0.49
  }
}
```

---

### 3.2 ç”Ÿæˆæ¯æ—¥å¤ç›˜æŠ¥å‘Š

**ç»„ä»¶**: `DailyReview.vue` (è‡ªåŠ¨è§¦å‘æˆ–æ‰‹åŠ¨è§¦å‘)

```
POST /api/v1/ai/daily-review
```

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,
  "account_id": 1,
  "date": "2025-01-17",
  "options": {
    "include_market_summary": true,
    "include_portfolio_performance": true,
    "include_events": true,
    "include_prediction": true,
    "include_weekly_outlook": true,
    "include_user_views": true
  }
}
```

**å“åº”**:
```json
{
  "code": 202,
  "message": "å¤ç›˜æŠ¥å‘Šç”Ÿæˆä¸­",
  "data": {
    "task_id": "review_task_xyz789",
    "status": "processing",
    "estimated_time": 30,
    "created_at": "2025-01-17T16:00:00Z"
  }
}
```

---

### 3.3 è·å–å†å²å¤ç›˜åˆ—è¡¨

**ç»„ä»¶**: `DailyReview.vue` (å†å²å¤ç›˜åŠŸèƒ½)

```
GET /api/v1/ai/daily-review/history
```

**Queryå‚æ•°**:
- `user_id` (number): ç”¨æˆ·ID
- `start_date` (string, optional): å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)
- `end_date` (string, optional): ç»“æŸæ—¥æœŸ (YYYY-MM-DD)
- `limit` (number, optional): è¿”å›æ¡æ•°ï¼Œé»˜è®¤30
- `offset` (number, optional): åç§»é‡ï¼Œé»˜è®¤0

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "total": 45,
    "reviews": [
      {
        "review_id": "review_20250117",
        "date": "2025-01-17",
        "market_index_change": "+0.85%",
        "portfolio_profit": 3200,
        "portfolio_profit_rate": 0.92,
        "has_prediction": true,
        "generated_at": "2025-01-17T16:00:00Z"
      },
      {
        "review_id": "review_20250116",
        "date": "2025-01-16",
        "market_index_change": "-0.32%",
        "portfolio_profit": -1500,
        "portfolio_profit_rate": -0.43,
        "has_prediction": true,
        "generated_at": "2025-01-16T16:00:00Z"
      }
    ]
  }
}
```

---

## 4. AIå¯¹è¯ API

### 4.1 åˆ›å»ºå¯¹è¯ä¼šè¯

**ç»„ä»¶**: `AIChat.vue`

```
POST /api/v1/ai/chat/sessions
```

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,
  "context": {
    "type": "stock",
    "symbol": "600600",
    "stock_name": "é’å²›å•¤é…’",
    "related_decision_id": 123,
    "related_analysis_result": {
      "ai_score": 7.2,
      "suggestion": "å»ºè®®åŠ ä»“"
    }
  }
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "session_id": "session_abc123",
    "created_at": "2025-01-17T14:30:00Z",
    "context_summary": "å½“å‰è®¨è®º: é’å²›å•¤é…’ (600600)"
  }
}
```

---

### 4.2 å‘é€æ¶ˆæ¯ï¼ˆæµå¼å“åº”ï¼‰

**ç»„ä»¶**: `AIChat.vue`

```
POST /api/v1/ai/chat/sessions/{session_id}/messages
```

**è·¯å¾„å‚æ•°**:
- `session_id` (string): ä¼šè¯ID

**è¯·æ±‚ä½“**:
```json
{
  "user_id": 1,
  "message": "ç°åœ¨é€‚åˆåŠ ä»“å—ï¼Ÿ",
  "stream": true
}
```

**å“åº” (stream=false)**:
```json
{
  "code": 200,
  "data": {
    "message_id": "msg_xyz789",
    "session_id": "session_abc123",
    "role": "assistant",
    "content": "å…³äºé’å²›å•¤é…’çš„åŠ ä»“å»ºè®®ï¼š\n\næ ¹æ®å½“å‰åˆ†æï¼š\n1. **æŠ€æœ¯é¢**ï¼šè‚¡ä»·å·²å›è°ƒè‡³æ”¯æ’‘ä½é™„è¿‘...",
    "tokens_used": 350,
    "created_at": "2025-01-17T14:31:00Z"
  }
}
```

**å“åº” (stream=true)** - SSEæµ:
```
data: {"type": "start", "message_id": "msg_xyz789"}

data: {"type": "token", "content": "å…³äº"}

data: {"type": "token", "content": "é’å²›å•¤é…’"}

data: {"type": "token", "content": "çš„åŠ ä»“å»ºè®®"}

...

data: {"type": "end", "tokens_used": 350}
```

---

### 4.3 è·å–ä¼šè¯å†å²

**ç»„ä»¶**: `AIChat.vue`

```
GET /api/v1/ai/chat/sessions/{session_id}/messages
```

**è·¯å¾„å‚æ•°**:
- `session_id` (string): ä¼šè¯ID

**Queryå‚æ•°**:
- `limit` (number, optional): è¿”å›æ¡æ•°ï¼Œé»˜è®¤50
- `offset` (number, optional): åç§»é‡ï¼Œé»˜è®¤0

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "session_id": "session_abc123",
    "total_messages": 8,
    "messages": [
      {
        "message_id": "msg_001",
        "role": "system",
        "content": "æ‚¨å¥½ï¼æˆ‘æ˜¯AIæŠ•èµ„åŠ©æ‰‹...",
        "created_at": "2025-01-17T14:30:00Z"
      },
      {
        "message_id": "msg_002",
        "role": "user",
        "content": "ç°åœ¨é€‚åˆåŠ ä»“å—ï¼Ÿ",
        "created_at": "2025-01-17T14:31:00Z"
      },
      {
        "message_id": "msg_003",
        "role": "assistant",
        "content": "å…³äºé’å²›å•¤é…’çš„åŠ ä»“å»ºè®®...",
        "tokens_used": 350,
        "created_at": "2025-01-17T14:31:15Z"
      }
    ]
  }
}
```

---

### 4.4 åˆ é™¤ä¼šè¯

**ç»„ä»¶**: `AIChat.vue` (æ¸…ç©ºå¯¹è¯åŠŸèƒ½)

```
DELETE /api/v1/ai/chat/sessions/{session_id}
```

**è·¯å¾„å‚æ•°**:
- `session_id` (string): ä¼šè¯ID

**å“åº”**:
```json
{
  "code": 200,
  "message": "ä¼šè¯å·²åˆ é™¤"
}
```

---

## 5. æ•°æ®æ¨¡å‹

### 5.1 StockReview (ç”¨æˆ·è‚¡ç¥¨è¯„ä»·)

```typescript
interface StockReview {
  review_id: number
  user_id: number
  symbol: string
  stock_name: string
  rating: number  // 1-5
  bullish_reasons: string[]
  bearish_reasons: string[]
  holding_logic: string
  target_price: number | null
  stop_loss_price: number | null
  strategy_notes: string
  last_updated: string  // ISO 8601
  created_at: string
}
```

### 5.2 ReviewLog (è¯„ä»·æ—¥å¿—)

```typescript
interface ReviewLog {
  id: number
  review_id: number
  user_id: number
  symbol: string
  log_type: 'created' | 'rating_changed' | 'bullish_reasons_updated' |
            'bearish_reasons_updated' | 'holding_logic_updated' |
            'target_price_updated' | 'stop_loss_price_updated'
  description: string
  note: string
  change_snapshot: Record<string, any>
  stock_price_at_time: number
  holding_quantity: number | null
  holding_cost: number | null
  created_at: string
}
```

### 5.3 AIAnalysisResult (AIåˆ†æç»“æœ)

```typescript
interface AIAnalysisResult {
  symbol: string
  name: string
  ai_score: number  // 0-10
  fundamental_score: number
  technical_score: number
  valuation_score: number
  suggestion: string  // "å»ºè®®æŒæœ‰" | "å»ºè®®åŠ ä»“" | "å»ºè®®å‡ä»“"
  strategy: {
    target_price: string
    position_size: string
    risk_control: string
  }
  detailed_analysis: {
    fundamentals: AnalysisDetail
    technicals: AnalysisDetail
    valuation: AnalysisDetail
  }
  confidence: number  // 0-1
  analyzed_at: string
}

interface AnalysisDetail {
  score: number
  strengths?: string[]
  weaknesses?: string[]
  summary: string
  // ... å…¶ä»–å…·ä½“ç»´åº¦çš„å­—æ®µ
}
```

### 5.4 DailyReview (æ¯æ—¥å¤ç›˜)

```typescript
interface DailyReview {
  review_id: string
  date: string  // YYYY-MM-DD
  user_id: number
  market_summary: MarketSummary
  portfolio_performance: PortfolioPerformance
  important_events: Event[]
  tomorrow_prediction: Prediction
  weekly_outlook: WeeklyOutlook
  user_views_summary: UserViewSummary[]
  generated_at: string
  tokens_used: number
  generation_cost: number
}
```

### 5.5 ChatMessage (å¯¹è¯æ¶ˆæ¯)

```typescript
interface ChatMessage {
  message_id: string
  session_id: string
  role: 'user' | 'assistant' | 'system'
  content: string
  tokens_used?: number
  created_at: string
}

interface ChatSession {
  session_id: string
  user_id: number
  context: {
    type: 'stock' | 'portfolio' | 'general'
    symbol?: string
    stock_name?: string
    related_decision_id?: number
    related_analysis_result?: any
  }
  created_at: string
  last_message_at?: string
}
```

---

## 6. é€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "code": 200,
  "message": "Success",
  "data": { ... }
}
```

### é”™è¯¯å“åº”

```json
{
  "code": 400,
  "message": "Invalid request",
  "error": {
    "type": "ValidationError",
    "details": [
      {
        "field": "rating",
        "message": "è¯„åˆ†å¿…é¡»åœ¨1-5ä¹‹é—´"
      }
    ]
  }
}
```

### å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 200 | æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 202 | å·²æ¥å—ï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ |
| 403 | ç¦æ­¢è®¿é—® |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 503 | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ |

---

## 7. è®¤è¯æ–¹å¼

æ‰€æœ‰APIè¯·æ±‚éœ€è¦æºå¸¦è®¤è¯ä¿¡æ¯ï¼š

### Headeræ–¹å¼

```http
Authorization: Bearer {token}
```

### Queryå‚æ•°æ–¹å¼ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

```
?token={token}
```

---

## 8. é€Ÿç‡é™åˆ¶

| æ¥å£ç±»å‹ | é™åˆ¶ |
|---------|------|
| AIåˆ†ææ¥å£ | 100æ¬¡/å°æ—¶/ç”¨æˆ· |
| AIå¯¹è¯æ¥å£ | 200æ¬¡/å°æ—¶/ç”¨æˆ· |
| æ•°æ®æŸ¥è¯¢æ¥å£ | 1000æ¬¡/å°æ—¶/ç”¨æˆ· |
| æ•°æ®å†™å…¥æ¥å£ | 500æ¬¡/å°æ—¶/ç”¨æˆ· |

è¶…è¿‡é™åˆ¶è¿”å› `429 Too Many Requests`

---

## 9. WebSocketå®æ—¶æ¥å£ï¼ˆå¯é€‰ï¼‰

### 9.1 AIåˆ†æè¿›åº¦æ¨é€

```javascript
// è¿æ¥
ws://api.example.com/ws/ai/analysis/{task_id}?token={token}

// æœåŠ¡ç«¯æ¨é€æ¶ˆæ¯
{
  "type": "progress",
  "data": {
    "progress": 33,
    "current_analyzing": "æ¯”äºšè¿ª (002594)",
    "completed_stocks": 1,
    "total_stocks": 3
  }
}

// å®Œæˆæ¶ˆæ¯
{
  "type": "completed",
  "data": {
    "task_id": "task_abc123",
    "status": "completed",
    "results": [ ... ]
  }
}
```

---

## 10. æ¥å£ä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»å®ç°ï¼‰

1. âœ… è·å–è‚¡ç¥¨è¯„ä»· - `GET /api/v1/reviews/{symbol}`
2. âœ… ä¿å­˜è‚¡ç¥¨è¯„ä»· - `POST /api/v1/reviews/{symbol}`
3. âœ… æ‰¹é‡AIåˆ†æ - `POST /api/v1/ai/daily-analysis`
4. âœ… æŸ¥è¯¢åˆ†æè¿›åº¦ - `GET /api/v1/ai/daily-analysis/{task_id}/progress`
5. âœ… è·å–åˆ†æç»“æœ - `GET /api/v1/ai/daily-analysis/{task_id}/results`

### P1 - é‡è¦åŠŸèƒ½ï¼ˆç¬¬äºŒæ‰¹å®ç°ï¼‰

6. âœ… è·å–æ¯æ—¥å¤ç›˜ - `GET /api/v1/ai/daily-review`
7. âœ… ç”Ÿæˆæ¯æ—¥å¤ç›˜ - `POST /api/v1/ai/daily-review`
8. âœ… åˆ›å»ºå¯¹è¯ä¼šè¯ - `POST /api/v1/ai/chat/sessions`
9. âœ… å‘é€å¯¹è¯æ¶ˆæ¯ - `POST /api/v1/ai/chat/sessions/{session_id}/messages`

### P2 - è¾…åŠ©åŠŸèƒ½ï¼ˆç¬¬ä¸‰æ‰¹å®ç°ï¼‰

10. è·å–è¯„ä»·æ—¥å¿— - `GET /api/v1/reviews/{symbol}/logs`
11. è·å–å†å²å¤ç›˜ - `GET /api/v1/ai/daily-review/history`
12. è·å–ä¼šè¯å†å² - `GET /api/v1/ai/chat/sessions/{session_id}/messages`
13. è·å–å¯åˆ†æè‚¡ç¥¨åˆ—è¡¨ - `GET /api/v1/ai/daily-analysis/stocks`

---

## 11. åç»­æ‰©å±•

### 11.1 æ¨èç³»ç»ŸAPI

```
GET /api/v1/ai/recommendations
```

ç”¨äºè·å–AIä¸»åŠ¨æ¨èçš„è‚¡ç¥¨ä¹°å…¥/å–å‡ºå»ºè®®ã€‚

### 11.2 ç­–ç•¥å›æµ‹API

```
POST /api/v1/ai/backtest
```

æ ¹æ®ç”¨æˆ·çš„è¯„ä»·å’ŒAIå»ºè®®è¿›è¡Œç­–ç•¥å›æµ‹ã€‚

### 11.3 è§‚ç‚¹å¯¹æ¯”åˆ†æ

```
GET /api/v1/ai/view-comparison
```

å¯¹æ¯”ç”¨æˆ·è¯„ä»·ä¸AIåˆ†æçš„å·®å¼‚ï¼Œç”Ÿæˆæ”¹è¿›å»ºè®®ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤è€…**: AI Investment System Team
**æœ€åå®¡æ ¸**: 2025-01-17
