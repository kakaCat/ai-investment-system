# v3.2 APIæ¥å£æ¸…å•æ€»ç»“

> ç®€æ´ç‰ˆæ¥å£åˆ—è¡¨ï¼Œç”¨äºå¿«é€ŸæŸ¥é˜…

**ç‰ˆæœ¬**: v3.2
**æœ€åæ›´æ–°**: 2025-11-20

---

## ğŸ“Š æ¥å£ç»Ÿè®¡

- **æ€»è®¡**: 13ä¸ªæ ¸å¿ƒæ¥å£
- **ç”¨æˆ·è¯„ä»·**: 3ä¸ªæ¥å£
- **AIåˆ†æ**: 4ä¸ªæ¥å£
- **æ¯æ—¥å¤ç›˜**: 3ä¸ªæ¥å£
- **AIå¯¹è¯**: 3ä¸ªæ¥å£

---

## 1ï¸âƒ£ ç”¨æˆ·è‚¡ç¥¨è¯„ä»· (3ä¸ª)

| åºå· | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|------|------|--------|
| 1.1 | `POST` | `/api/v1/review/get` | è·å–è‚¡ç¥¨è¯„ä»· | P0 |
| 1.2 | `POST` | `/api/v1/review/save` | åˆ›å»º/æ›´æ–°è¯„ä»· | P0 |
| 1.3 | `POST` | `/api/v1/review/logs` | è·å–è¯„ä»·æ—¥å¿— | P2 |

**å¯¹åº”ç»„ä»¶**: `StockReview.vue`

---

## 2ï¸âƒ£ æ¯æ—¥AIåˆ†æ (4ä¸ª)

| åºå· | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|------|------|--------|
| 2.1 | `POST` | `/api/v1/ai/daily-analysis/create` | æäº¤æ‰¹é‡åˆ†æä»»åŠ¡ | P0 |
| 2.2 | `POST` | `/api/v1/ai/daily-analysis/results` | æŸ¥è¯¢åˆ†æç»“æœ | P0 |
| 2.3 | `POST` | `/api/v1/ai/single-analysis` | å•è‚¡åˆ†æ | P1 |
| 2.4 | `POST` | `/api/v1/ai/suggestions` | è·å–AIæ“ä½œå»ºè®® | P1 |

**å¯¹åº”ç»„ä»¶**: `DailyAIAnalysis.vue`

**å·¥ä½œæµç¨‹**:
```
1. æäº¤åˆ†æä»»åŠ¡ (2.1) â†’ è¿”å› task_id
   â†“
2. è½®è¯¢æŸ¥è¯¢ç»“æœ (2.2) â†’ status: pending/processing/completed
   â†“
3. å®Œæˆåå±•ç¤ºå®Œæ•´ç»“æœ
```

---

## 3ï¸âƒ£ æ¯æ—¥å¤ç›˜ (3ä¸ª)

| åºå· | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|------|------|--------|
| 3.1 | `POST` | `/api/v1/ai/review/get` | è·å–æ¯æ—¥å¤ç›˜æŠ¥å‘Š | P1 |
| 3.2 | `POST` | `/api/v1/ai/review/generate` | ç”Ÿæˆæ¯æ—¥å¤ç›˜æŠ¥å‘Š | P1 |
| 3.3 | `POST` | `/api/v1/ai/review/history` | è·å–å†å²å¤ç›˜åˆ—è¡¨ | P2 |

**å¯¹åº”ç»„ä»¶**: `DailyReview.vue`

**å¤ç›˜æŠ¥å‘ŠåŒ…å«**:
- âœ… å¸‚åœºæ€»ç»“ï¼ˆå¤§ç›˜ã€çƒ­ç‚¹æ¿å—ã€ç–²è½¯æ¿å—ï¼‰
- âœ… æŒä»“è¡¨ç°ï¼ˆä»Šæ—¥ç›ˆäºã€æ¶¨è·Œæ¦œï¼‰
- âœ… é‡è¦äº‹ä»¶å½±å“
- âœ… æ˜æ—¥é¢„æµ‹ï¼ˆå¤§ç›˜ç ”åˆ¤ã€å…³æ³¨æ¿å—ã€é£é™©æç¤ºã€æ“ä½œå»ºè®®ï¼‰
- âœ… æœªæ¥ä¸€å‘¨å±•æœ›
- âœ… æˆ‘çš„æŠ•èµ„è§‚ç‚¹æ±‡æ€»ï¼ˆAI vs ç”¨æˆ·è¯„ä»·å¯¹æ¯”ï¼‰

---

## 4ï¸âƒ£ AIå¯¹è¯ (3ä¸ª)

| åºå· | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|------|------|--------|
| 4.1 | `POST` | `/api/v1/ai/chat` | ç®€åŒ–AIå¯¹è¯ | P1 |
| 4.2 | `POST` | `/api/v1/ai/chat/session/create` | åˆ›å»ºå¯¹è¯ä¼šè¯ | P1 |
| 4.3 | `POST` | `/api/v1/ai/chat/message/send` | å‘é€æ¶ˆæ¯ | P1 |
| 4.4 | `POST` | `/api/v1/ai/chat/history` | è·å–ä¼šè¯å†å² | P2 |

**å¯¹åº”ç»„ä»¶**: `AIChat.vue`

**æ”¯æŒä¸Šä¸‹æ–‡**:
- è‚¡ç¥¨ä»£ç å’Œåç§°
- å…³è”çš„AIåˆ†æç»“æœ
- ç”¨æˆ·è¯„ä»·ä¿¡æ¯

---

## ğŸš€ å®ç°ä¼˜å…ˆçº§

### P0 - å¿…é¡»å®ç°ï¼ˆç¬¬ä¸€æ‰¹ï¼‰

**æ ¸å¿ƒåŠŸèƒ½ï¼Œæ— è¿™äº›æ¥å£å‰ç«¯æ— æ³•å·¥ä½œ**

1. âœ… `POST /api/v1/review/get` - è·å–è‚¡ç¥¨è¯„ä»·
2. âœ… `POST /api/v1/review/save` - ä¿å­˜è‚¡ç¥¨è¯„ä»·
3. âœ… `POST /api/v1/ai/daily-analysis/create` - æäº¤æ‰¹é‡åˆ†æ
4. âœ… `POST /api/v1/ai/daily-analysis/results` - è·å–åˆ†æç»“æœ

**é¢„è®¡å·¥ä½œé‡**: 3-5å¤©

---

### P1 - é‡è¦åŠŸèƒ½ï¼ˆç¬¬äºŒæ‰¹ï¼‰

**æå‡ç”¨æˆ·ä½“éªŒçš„é‡è¦åŠŸèƒ½**

6. âœ… `POST /api/v1/ai/review/get` - è·å–æ¯æ—¥å¤ç›˜
7. âœ… `POST /api/v1/ai/review/generate` - ç”Ÿæˆæ¯æ—¥å¤ç›˜
8. âœ… `POST /api/v1/ai/chat` - ç®€åŒ–AIå¯¹è¯
9. âœ… `POST /api/v1/ai/chat/message/send` - å‘é€å¯¹è¯æ¶ˆæ¯

**é¢„è®¡å·¥ä½œé‡**: 3-4å¤©

---

### P2 - è¾…åŠ©åŠŸèƒ½ï¼ˆç¬¬ä¸‰æ‰¹ï¼‰

**é”¦ä¸Šæ·»èŠ±çš„åŠŸèƒ½ï¼Œå¯åç»­è¿­ä»£**

10. `POST /api/v1/review/logs` - è·å–è¯„ä»·æ—¥å¿—
11. `POST /api/v1/ai/review/history` - è·å–å†å²å¤ç›˜
12. `POST /api/v1/ai/chat/history` - è·å–ä¼šè¯å†å²
13. `POST /api/v1/ai/review/stocks` - è·å–å¯åˆ†æè‚¡ç¥¨åˆ—è¡¨

**é¢„è®¡å·¥ä½œé‡**: 2-3å¤©

---

## ğŸ“‹ å¿«é€ŸæŸ¥è¯¢è¡¨

### æŒ‰åŠŸèƒ½æŸ¥æ‰¾

| æˆ‘æƒ³... | ä½¿ç”¨æ¥å£ |
|---------|----------|
| æŸ¥çœ‹/ä¿å­˜è‚¡ç¥¨è¯„ä»· | `POST /api/v1/review/get` / `POST /api/v1/review/save` |
| æ‰¹é‡åˆ†æå¤šåªè‚¡ç¥¨ | `POST /api/v1/ai/daily-analysis/create` |
| æŸ¥çœ‹åˆ†æç»“æœ | `POST /api/v1/ai/daily-analysis/results` |
| æŸ¥çœ‹ä»Šæ—¥å¤ç›˜ | `POST /api/v1/ai/review/get` |
| ä¸AIå¯¹è¯è¯¢é—® | `POST /api/v1/ai/chat` / `POST /api/v1/ai/chat/message/send` |
| æŸ¥çœ‹è¯„ä»·ä¿®æ”¹å†å² | `POST /api/v1/review/logs` |
| æŸ¥çœ‹å†å²å¤ç›˜ | `POST /api/v1/ai/review/history` |

---

### æŒ‰ç»„ä»¶æŸ¥æ‰¾

| ç»„ä»¶ | éœ€è¦çš„æ¥å£ |
|------|-----------|
| `StockReview.vue` | 1.1, 1.2, 1.3 |
| `DailyAIAnalysis.vue` | 2.1, 2.2, 2.3, 2.4 |
| `DailyReview.vue` | 3.1, 3.2, 3.3 |
| `AIChat.vue` | 4.1, 4.2, 4.3 |

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### å¼‚æ­¥ä»»åŠ¡å¤„ç†

**AIåˆ†æå’Œå¤ç›˜ç”Ÿæˆæ˜¯å¼‚æ­¥ä»»åŠ¡**:

1. å‰ç«¯æäº¤ä»»åŠ¡ â†’ åç«¯è¿”å› `task_id` (HTTP 202)
2. å‰ç«¯è½®è¯¢è¿›åº¦ â†’ æ¯2ç§’è°ƒç”¨ä¸€æ¬¡è¿›åº¦æ¥å£
3. ä»»åŠ¡å®Œæˆ â†’ å‰ç«¯è·å–å®Œæ•´ç»“æœ

**æ¨èå®ç°æ–¹å¼**:
- ä»»åŠ¡é˜Ÿåˆ—: Celery / RQ
- ç»“æœç¼“å­˜: Redis
- è¿›åº¦å­˜å‚¨: Redis Hash

---

### æµå¼å“åº”ï¼ˆAIå¯¹è¯ï¼‰

**å‘é€æ¶ˆæ¯æ¥å£æ”¯æŒä¸¤ç§æ¨¡å¼**:

**æ¨¡å¼1: æ™®é€šå“åº” (`stream: false`)**
```json
POST /api/v1/ai/chat/message/send
{
  "message": "ç°åœ¨é€‚åˆåŠ ä»“å—ï¼Ÿ",
  "stream": false
}
```
â†’ ç­‰å¾…AIå®Œæ•´å›å¤åè¿”å›

**æ¨¡å¼2: æµå¼å“åº” (`stream: true`)**
```json
{
  "message": "ç°åœ¨é€‚åˆåŠ ä»“å—ï¼Ÿ",
  "stream": true
}
```
â†’ ä½¿ç”¨ Server-Sent Events (SSE) å®æ—¶æ¨é€token

**å‰ç«¯å®ç°**:
```typescript
const eventSource = new EventSource(`/api/v1/ai/chat/message/send?session_id=${sessionId}&stream=true`)
eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data)
  // é€å­—æ˜¾ç¤º
}
```

---

### è®¤è¯ä¸é‰´æƒ

**æ‰€æœ‰æ¥å£éƒ½éœ€è¦è®¤è¯**:

```http
Authorization: Bearer {jwt_token}
```

**ç”¨æˆ·éš”ç¦»**:
- æ‰€æœ‰æ•°æ®æŸ¥è¯¢å¿…é¡»å¸¦ `user_id`
- åç«¯éªŒè¯ `user_id` ä¸ token åŒ¹é…
- ç¦æ­¢è·¨ç”¨æˆ·è®¿é—®æ•°æ®

---

### é€Ÿç‡é™åˆ¶

| æ¥å£ç±»å‹ | é™åˆ¶ | Header |
|---------|------|--------|
| AIåˆ†æ | 100æ¬¡/å°æ—¶ | `X-RateLimit-Limit: 100` |
| AIå¯¹è¯ | 200æ¬¡/å°æ—¶ | `X-RateLimit-Remaining: 95` |
| æ•°æ®æŸ¥è¯¢ | 1000æ¬¡/å°æ—¶ | `X-RateLimit-Reset: 1642435200` |

**è¶…é™å“åº”**:
```json
{
  "code": 429,
  "message": "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•",
  "retry_after": 3600
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´APIæ–‡æ¡£](./v3.2-api-list.md)
- [æ•°æ®åº“è®¾è®¡](../database/schema-v1.md)
- [PRD v3.2 Section 2.11](../../prd/v3/sections/02-core-features.md)
- [HTMLåŸå‹](../ui/html-prototypes/README.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤è€…**: AI Investment System Team
